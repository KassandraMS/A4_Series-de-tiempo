---
title: "Propuesta ‚Äî Series de Tiempo (Kaggle: Australia Monthly Retail Turnover)"
author: "Edgar Esteban Grajales, Kassandra Mendoza-Sarmiento y Paula Tovar R√≠os"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
site: bookdown::bookdown_site
output: bookdown::gitbook

---


# Introducci√≥n

La presente propuesta corresponde a la Actividad 1 del curso An√°lisis de Series de Tiempo,en este actividad se aplica el uso de herramientas TIC, espec√≠ficamente Bookdown en RStudio y GitHub Pages, para elaborar un documento reproducible que describe el enfoque del proyecto y la base de datos seleccionada para el an√°lisis.

El prop√≥sito central es definir el contexto y la relevancia del estudio, identificando la informaci√≥n a pronosticar, su valor agregado y los alcances del an√°lisis de series de tiempo propuesto. La propuesta utiliza el dataset p√∫blico ‚ÄúAustralia Monthly Retail Turnover‚Äù disponible en Kaggle, lo que permite explorar comportamientos econ√≥micos mensuales y sentar las bases para futuros modelos de predicci√≥n orientados a la toma de decisiones basadas en datos.


# Unidad 1. Propuesta de informaci√≥n a pronosticar

## **Tema y base de datos**  
Se trabajar√° con la serie **Retail Turnover mensual de Australia** (ventas minoristas agregadas por mes). Esta informaci√≥n proviene del dataset p√∫blico ‚ÄúAustralia Monthly Retail Turnover‚Äù disponible en Kaggle y recoge el gasto mensual del comercio al por menor a nivel nacional.

## **Importancia y valor agregado** 

Pronosticar el *retail turnover* es √∫til para:

- **Planeaci√≥n comercial e inventarios:** anticipar meses de alta y baja demanda reduce quiebres y sobrestock, y gu√≠a compras y log√≠stica.

- **Gesti√≥n financiera:** mejora la elaboraci√≥n de presupuestos y flujo de caja al prever ingresos mensuales esperados.

- **Toma de decisiones t√°cticas:** permite calendarizar campa√±as y recursos (personal, distribuci√≥n) seg√∫n la estacionalidad identificada.

- **Evaluaci√≥n de choques:** ayuda a dimensionar el impacto de eventos excepcionales (feriados extendidos, crisis) sobre el consumo.


Por tanto, este an√°lisis permitir√° identificar patrones temporales que apoyen la toma de decisiones estrat√©gicas en el comercio minorista australiano.

## **Alcance propuesto**  

Se realizar√° una exploraci√≥n de la serie mensual, identificaci√≥n de tendencia y estacionalidad, y un pron√≥stico base a 12 meses con intervalos, suficiente para soportar decisiones de planeaci√≥n y seguimiento.

**Preguntas gu√≠a**  

1. ¬øExisten tendencias y estacionalidades por Estado/Industria?  
2. ¬øQu√© modelo (ETS vs ARIMA) ofrece mejor precisi√≥n por horizonte (3‚Äì6‚Äì12 meses)?  
3. ¬øC√≥mo cambian los pron√≥sticos agregando por Estado vs por Industria?

**Fuentes y permisos**  

- **Fuente:** Kaggle (2024). Australia Monthly Retail Turnover Dataset, autor: **kanyaweechomming101**. URL: https://www.kaggle.com/datasets/kanyaweechomming101/australia-monthly-retail-turnover-data.

- **ABS (Australian Bureau of Statistics)** como fuente estad√≠stica original (referenciada en la descripci√≥n del dataset).  

- **Uso**: datos p√∫blicos para fines acad√©micos;seg√∫n los t√©rminos publicados en la p√°gina del dataset; se citar√° la fuente en el documento. No contiene informaci√≥n personal.  

## **Conclusiones Unidad 1**

Esta propuesta demuestra el uso efectivo de herramientas TIC avanzadas, integrando **RStudio, Bookdown y GitHub Pages** como entornos para la gesti√≥n reproducible de documentos cient√≠ficos. A trav√©s del an√°lisis de la serie de tiempo ‚ÄúAustralia Monthly Retail Turnover‚Äù, se pretende identificar patrones y tendencias que permitan comprender la din√°mica del consumo minorista australiano y su evoluci√≥n en el tiempo.

Este trabajo constituye la base para la aplicaci√≥n de modelos predictivos que fortalezcan la toma de decisiones en entornos comerciales y acad√©micos, promoviendo la innovaci√≥n y la anal√≠tica como pilares de la gesti√≥n de datos.

---

# Unidad 2. An√°lisis descriptivo y estructural de una serie temporal: tendencia, estacionalidad y estacionariedad

En esta unidad se analizan los componentes fundamentales de una serie temporal nivel, tendencia, estacionalidad y ruido aplicando t√©cnicas gr√°ficas y estad√≠sticas de suavizamiento, descomposici√≥n y diferenciaci√≥n, con el fin de identificar su estructura y preparar la base para el modelamiento predictivo.


## **Descripci√≥n y justificaci√≥n del conjunto de datos**

El conjunto de datos utilizado corresponde al registro hist√≥rico del Retail Trade, Australia, disponible p√∫blicamente en Kaggle bajo el nombre ‚ÄúAustralia Monthly Retail Turnover Data‚Äù.
Este dataset recopila informaci√≥n mensual sobre el volumen de ventas minoristas en diferentes estados y sectores de la econom√≠a australiana desde 1982 hasta la actualidad.

Para este an√°lisis se descarg√≥ el archivo directamente desde Kaggle utilizando la librer√≠a reticulate y el m√≥dulo de Python kagglehub, lo cual garantiza la trazabilidad y reproducibilidad del proceso.
El bloque de c√≥digo permiti√≥ acceder autom√°ticamente a los archivos, identificar el formato de columnas y realizar una vista previa estructurada de las primeras observaciones del conjunto de datos (ver Tabla 1).

```{r setup-u2, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE, warning = FALSE, fig.align = "center",
  fig.width = 8, fig.height = 4.2, echo = TRUE
)

```



```{r}
library(readr)
library(dplyr)
library(lubridate)
library(ggplot2)
library(TTR)
library(zoo) 
library(janitor)
library(tidyverse)
library(tsibble)
library(fabletools)
library(reticulate)
library(forecast)
library(stringr)

# Helpers: SMA y EMA sin TTR
SMA_r <- function(x, n){
  if(n < 2) return(x)
  pad <- rep(NA_real_, n - 1L)
  c(pad, zoo::rollmean(x, k = n, align = "right", na.pad = FALSE))
}
EMA_r <- function(x, n){
  if(n < 2) return(x)
  alpha <- 2/(n + 1)
  x0 <- x
  first <- which(!is.na(x0))[1]
  if(length(first)==0) return(rep(NA_real_, length(x)))
  x0[1:first] <- x0[first]
  as.numeric(stats::filter(x0, alpha, method = "recursive"))
}
```


```{r, message=FALSE, warning=FALSE}
# === Descarga y vista previa organizada ===

# Asegurar dependencias
if (!requireNamespace("reticulate", quietly = TRUE)) install.packages("reticulate")
library(reticulate)
if (!py_module_available("kagglehub")) reticulate::py_install("kagglehub", pip = TRUE)

# 1) Descargar dataset desde Kaggle
kh <- reticulate::import("kagglehub")
dest_root <- kh$dataset_download("kanyaweechomming101/australia-monthly-retail-turnover-data")

# 2) Ubicar CSV
csvs <- list.files(dest_root, pattern = "\\.csv$", full.names = TRUE, recursive = TRUE)
stopifnot("No se encontraron archivos .csv" = length(csvs) > 0)
ruta_csv <- csvs[1]  # si hay varios, puedes cambiar el √≠ndice

# 3) Leer primeras filas
library(readr); library(dplyr); library(knitr)
peek <- read_csv(ruta_csv, n_max = 10, show_col_types = FALSE)

# 4) Mostrar encabezado y tabla organizada
cat("\nüì¶ **Vista previa del dataset: Retail Turnover Australia**\n")
cat("Archivo cargado desde Kaggle:", basename(ruta_csv), "\n")
cat("Ubicaci√≥n local:", dest_root, "\n\n")

peek %>%
  head(10) %>%
  kable(
    caption = "Tabla 1. Vista previa de las primeras 10 filas del dataset de ventas minoristas en Australia (Kaggle)",
    align = "c",
    col.names = c("Estado", "Industria", "ID Serie", "Mes", "Turnover")
  )

```


La tabla muestra las siguientes variables principales:

| **Variable** | **Descripci√≥n** |
|:-------------|:----------------|
| **State** | Estado o territorio australiano del cual proviene el registro. |
| **Industry** | Sector econ√≥mico o grupo de actividades comerciales. |
| **Series** | Identificador de la serie publicada por la oficina estad√≠stica australiana. |
| **Month** | Fecha del registro mensual (a√±o y mes). |
| **Turnover** | Valor total de ventas minoristas expresado en millones de d√≥lares australianos. |


Aunque el dataset contiene m√∫ltiples combinaciones de estado e industria, en esta actividad se analizar√° una serie √∫nica y representativa, correspondiente al ‚ÄúTotal (industry)‚Äù, que refleja el comportamiento global del comercio minorista australiano.
Esta decisi√≥n se tom√≥ porque el objetivo de la Unidad 2 es identificar tendencias, rezagos y estacionalidades en una serie de tiempo de manera clara, sin el ruido ni las fluctuaciones que presentan sectores individuales.

La selecci√≥n del Total (industry) permite:

Observar la tendencia agregada de las ventas en el pa√≠s.

Detectar con mayor precisi√≥n la estacionalidad mensual (patrones de aumento y disminuci√≥n).

Facilitar el uso de herramientas estad√≠sticas de suavizamiento y descomposici√≥n en los bloques siguientes.


A partir de la revisi√≥n de esta tabla y el entendimiento de su estructura, se confirma que el conjunto de datos es adecuado para el estudio de series temporales econ√≥micas, ya que presenta una variable cuantitativa (ventas) observada en intervalos regulares de tiempo (mensuales).
La amplitud temporal del dataset (m√°s de 40 a√±os) permitir√° analizar la evoluci√≥n del comercio minorista, identificando cambios estructurales, ciclos econ√≥micos y comportamientos estacionales que servir√°n como base para las siguientes etapas del an√°lisis.


## **Preparaci√≥n y filtrado de datos: serie total mensual**

```{r, message=FALSE, warning=FALSE}
df0 <- readr::read_csv(ruta_csv, show_col_types = FALSE)
names(df0) <- gsub("\\s+|\\.|\\(|\\)|\\[|\\]", "_", tolower(names(df0)))

# Detectar columnas clave
cand_fecha <- grep("date|month|period|time|fecha", names(df0), value = TRUE)
stopifnot("No encuentro columna de fecha" = length(cand_fecha) >= 1)
col_fecha <- cand_fecha[1]

col_ind <- if (any(grepl("industry|sector|categoria|group", names(df0)))) {
  grep("industry|sector|categoria|group", names(df0), value = TRUE)[1]
} else NA_character_

cand_val <- grep("turnover|value|ventas|importe|amount|index|volume", names(df0), value = TRUE)
if (length(cand_val) == 0) cand_val <- names(df0)[sapply(df0, is.numeric)]
stopifnot("No encuentro columna num√©rica de valor" = length(cand_val) >= 1)
col_valor <- cand_val[1]

# Parseo de fecha robusto (YYYY-MM o variantes)
df_parsed <- df0 %>%
  mutate(fecha_chr = as.character(.data[[col_fecha]])) %>%
  mutate(
    ym_try = suppressWarnings(zoo::as.yearmon(fecha_chr)),
    fecha  = dplyr::case_when(
      !is.na(ym_try) ~ as.Date(ym_try),
      TRUE ~ suppressWarnings(lubridate::parse_date_time(
        fecha_chr, orders = c("Y-m-d","d/m/Y","m/d/Y","Y-m","Ymd","dmY","mdY"), tz = "UTC"
      )) %>% as.Date()
    )
  ) %>%
  filter(!is.na(fecha))


industry_choice <- "Total (industry)"  # preferido
if (!is.na(col_ind)) {
  inds <- sort(unique(df_parsed[[col_ind]]))
  message("Industrias disponibles:\n- ", paste(inds, collapse = "\n- "))
  if (!industry_choice %in% inds) {
    patt <- "(?i)total.*industry|all industries|overall"
    cand <- grep(patt, inds, value = TRUE)
    if (length(cand) > 0) industry_choice <- cand[1]
  }
  if (industry_choice %in% unique(df_parsed[[col_ind]])) {
    df <- df_parsed %>%
      filter(.data[[col_ind]] == industry_choice) %>%
      mutate(valor = suppressWarnings(as.numeric(.data[[col_valor]]))) %>%
      select(fecha, valor) %>%
      arrange(fecha)
    message("Usando industria/segmento: ", industry_choice)
  } else {
    # Fallback: sumar todas las industrias por mes
    df <- df_parsed %>%
      mutate(valor = suppressWarnings(as.numeric(.data[[col_valor]]))) %>%
      group_by(fecha) %>%
      summarise(valor = sum(valor, na.rm = TRUE), .groups = "drop") %>%
      arrange(fecha)
    message("No encontr√© 'Total (industry)'. Usando TOTAL mensual (suma de todas las industrias).")
  }
} else {
  # Si no existe columna de industria, seguimos con la √∫nica serie
  df <- df_parsed %>%
    mutate(valor = suppressWarnings(as.numeric(.data[[col_valor]]))) %>%
    select(fecha, valor) %>%
    arrange(fecha)
  message("No hay columna de industria. Usando la serie disponible.")
}


cat("\n **Serie agregada: Total mensual de ventas minoristas (Australia)**\n")
cat("Cada observaci√≥n representa el valor total mensual del comercio minorista sumando todas las industrias.\n\n")

df %>%
  head(10) %>%
  kable(
    caption = "Tabla 2. Serie total mensual de ventas minoristas en Australia (primeras 10 observaciones).",
    align = "c",
    col.names = c("Fecha", "Valor (millones de AUD)")
  )

```


Una vez identificado el conjunto de datos original, el siguiente paso consisti√≥ en preparar la informaci√≥n y filtrar la serie temporal de inter√©s.
El dataset inicial incluye registros mensuales desagregados por estado e industria, lo que genera m√∫ltiples combinaciones posibles.
Para los fines de esta Unidad ‚Äîcentrados en el an√°lisis de la estructura de los datos y la identificaci√≥n de patrones temporales‚Äî se seleccion√≥ una serie agregada, correspondiente al total mensual de ventas minoristas a nivel nacional.

El c√≥digo ejecutado agrupa los registros por la variable fecha y suma el valor del ‚ÄúTurnover‚Äù (ventas) de todas las industrias disponibles.
De este modo, se obtiene una serie m√°s estable y representativa del comportamiento general del comercio minorista australiano.

La Tabla 2 presenta las primeras observaciones de la serie consolidada. En ella se observan las columnas:

| **Variable** | **Descripci√≥n** |
|:-------------|:----------------|
| **Fecha** | Corresponde al primer d√≠a del mes registrado (en formato YYYY-MM-DD). |
| **Valor (millones de AUD)** | Monto total de ventas minoristas acumuladas para todas las industrias en el mes correspondiente. |

Esta transformaci√≥n permite trabajar con una sola serie continua en el tiempo, eliminando la variabilidad interna de los diferentes sectores y conservando la estructura mensual necesaria para los an√°lisis posteriores de tendencia, promedio m√≥vil, rezagos y estacionalidad.

## **Construcci√≥n de la serie temporal**

```{r, message=FALSE, warning=FALSE}
# Construcci√≥n de la serie temporal y visualizaci√≥n inicial
library(ggplot2)
library(knitr)
library(lubridate)

# 1. Definir frecuencia y convertir a serie de tiempo (mensual)
freq_ts   <- 12L
start_year <- lubridate::year(min(df$fecha, na.rm = TRUE))
start_mon  <- lubridate::month(min(df$fecha, na.rm = TRUE))
ts_y <- ts(df$valor, start = c(start_year, start_mon), frequency = freq_ts)

# 2. Mostrar mensaje informativo con formato
cat("\nüìà **Serie temporal creada correctamente**\n")
cat("Frecuencia:", freq_ts, "meses por ciclo (serie mensual)\n")
cat("Inicio de la serie:", paste0(start_year, "-", start_mon), "\n")
cat("N√∫mero total de observaciones:", length(ts_y), "\n\n")

# 3. Tabla resumen inicial (primeros y √∫ltimos valores)
summary_tbl <- data.frame(
  "Periodo inicial" = as.character(df$fecha[1]),
  "Periodo final"   = as.character(df$fecha[nrow(df)]),
  "Observaciones"   = nrow(df),
  "Frecuencia"      = "Mensual (12)"
)

kable(
  summary_tbl,
  caption = "Tabla 3. Resumen de la configuraci√≥n de la serie temporal (Total retail turnover, Australia)",
  align = "c"
)

# 4. Gr√°fico base con estilo estructurado y color corporativo
ggplot(df, aes(x = fecha, y = valor)) +
  geom_line(color = "#0072B2", linewidth = 0.8) +
  geom_smooth(method = "loess", se = FALSE, color = "#009E73", linewidth = 0.8, linetype = "solid") +
  labs(
    title = "Figura 1. Serie temporal en nivel ‚Äî Total Retail Turnover (Australia)",
    subtitle = "Ventas minoristas agregadas a nivel nacional (1982‚Äì2024)",
    x = "A√±o",
    y = "Turnover (millones de AUD)"
  ) +
  theme_bw(base_size = 11) +
  theme(
    plot.title = element_text(face = "bold", color = "#333333", size = 13),
    plot.subtitle = element_text(color = "#555555", size = 10),
    axis.title.y = element_text(face = "bold", color = "#0072B2"),
    axis.text = element_text(color = "#333333"),
    panel.border = element_rect(color = "#cccccc"),
    panel.grid.minor = element_blank()
  )

```


Una vez consolidada la base de datos con las observaciones mensuales, se construy√≥ el objeto ts que representa la serie temporal del total de ventas minoristas en Australia.
La frecuencia definida fue mensual (frequency = 12), lo que permite capturar los ciclos anuales y analizar la estacionalidad.
El rango temporal de la serie abarca desde abril de 1982 hasta el √∫ltimo periodo disponible en el dataset (2024).

La Tabla 3 resume los par√°metros generales de configuraci√≥n de la serie, incluyendo el n√∫mero total de observaciones, frecuencia y periodo de inicio y fin.

Visualizaci√≥n inicial de la serie

La Figura 1 presenta la serie temporal en su nivel original.
En el gr√°fico se observa una tendencia ascendente pronunciada que refleja el crecimiento sostenido del comercio minorista australiano a lo largo de m√°s de cuatro d√©cadas.
Adem√°s, se aprecian fluctuaciones regulares que sugieren la presencia de estacionalidad mensual, posiblemente relacionada con patrones de consumo estacionales (por ejemplo, picos en diciembre por las ventas navide√±as).

La l√≠nea azul muestra la evoluci√≥n mensual del volumen de ventas, mientras que la l√≠nea verde (suavizada mediante el m√©todo LOESS) permite identificar con mayor claridad la tendencia general de crecimiento.
Esta visualizaci√≥n inicial confirma que la serie no es estacionaria en nivel, ya que su media y su varianza var√≠an con el tiempo.


Con este punto obtendremos la estructura base sobre la cual se aplicar√°n las siguientes t√©cnicas:

Promedios m√≥viles (SMA/EMA) para suavizar fluctuaciones,

Rezagos y diferencias para analizar dependencias temporales, y

Gr√°ficos de estacionalidad y autocorrelaci√≥n para estudiar los ciclos repetitivos.


## **Promedios m√≥viles (SMA/EMA) y an√°lisis de tendencia**

El promedio m√≥vil es una t√©cnica de suavizamiento usada para resaltar la tendencia de una serie temporal, reduciendo el ruido de corto plazo.
Existen dos tipos principales:

SMA (Simple Moving Average): promedio aritm√©tico de los √∫ltimos ùëò valores.

EMA (Exponential Moving Average): promedio ponderado donde los valores m√°s recientes tienen mayor peso.


F√≥rmulas

**Media m√≥vil simple (SMA):**

$$
SMA_t = \frac{1}{k} \sum_{i=0}^{k-1} Y_{t-i}
$$

**Media m√≥vil exponencial (EMA):**

$$
EMA_t = \alpha Y_t + (1 - \alpha) EMA_{t-1}, \quad \alpha = \frac{2}{k + 1}
$$

En el dataset Australia Monthly Retail Turnover (1982‚Äì2024),se aplicaron dos ventanas:

Ventana corta: 6 meses (EMA) para capturar variaciones r√°pidas.

Ventana larga: 12 meses (SMA) para suavizar el ciclo anual.

Estas t√©cnicas permiten observar la tendencia subyacente de crecimiento del comercio minorista australiano sin el efecto de los picos mensuales.


```{r, message=FALSE, warning=FALSE}
# Promedios m√≥viles (SMA / EMA) y an√°lisis de tendencia ===
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(knitr)

# 1. Calcular SMA y EMA
EMA_classic <- function(x, n){
  alpha <- 2/(n + 1)
  y <- rep(NA_real_, length(x))
  idx <- which(!is.na(x))
  if(length(idx) == 0) return(y)
  y[idx[1]] <- x[idx[1]]
  for(i in idx[-1]) y[i] <- alpha * x[i] + (1 - alpha) * y[i - 1]
  y
}

k_short <- 6    # EMA(6)
k_long  <- 12   # SMA(12)

df <- df %>%
  mutate(
    `Nivel`     = valor,
    `SMA (12m)` = zoo::rollmean(valor, k_long, fill = NA, align = "right"),
    `EMA (6m)`  = EMA_classic(valor, k_short)
  )

#2. Tabla de par√°metros
param_tbl <- data.frame(
  check.names = FALSE,
  `Ventana corta (EMA 6m)`  = paste(k_short, "meses"),
  `Ventana larga (SMA 12m)` = paste(k_long,  "meses"),
  `Tipo de suavizamiento`   = "Media m√≥vil simple (SMA) y exponencial (EMA)"
)

kable(
  param_tbl,
  caption = "Tabla 3. Par√°metros utilizados para el c√°lculo de promedios m√≥viles.",
  align = "c"
)

# 3. Preparar datos largos para ggplot 
df_long <- df %>%
  select(fecha, `Nivel`, `SMA (12m)`, `EMA (6m)`) %>%
  pivot_longer(-fecha, names_to = "Serie", values_to = "valor")

df_long$Serie <- factor(df_long$Serie,
                        levels = c("Nivel", "SMA (12m)", "EMA (6m)"))

colores   <- c("Nivel" = "#0072B2", "SMA (12m)" = "#009E73", "EMA (6m)" = "#D55E00")
linetypes <- c("Nivel" = "solid",   "SMA (12m)" = "solid",   "EMA (6m)" = "dashed")

# 4. Figura comparativa 
ggplot(df_long, aes(x = fecha, y = valor, color = Serie, linetype = Serie)) +
  geom_line(linewidth = 0.9, alpha = 0.9, na.rm = TRUE) +
  scale_color_manual(values = colores) +
  scale_linetype_manual(values = linetypes) +
  labs(
    title    = "Figura 2. Tendencia suavizada ‚Äî Nivel, SMA(12) y EMA(6)",
    x = "A√±o",
    y = "Turnover (millones de AUD)",
    color = "Serie",
    linetype = "Serie"
  ) +
  theme_bw(base_size = 11) +
  theme(
    plot.title    = element_text(face = "bold", size = 13, color = "#333333"),
    plot.subtitle = element_text(color = "#555555", size = 10),
    axis.title.y  = element_text(color = "#0072B2", face = "bold"),
    legend.position = "top",
    legend.title    = element_text(face = "bold"),
    panel.border  = element_rect(color = "#cccccc")
  )
```

El an√°lisis de promedios m√≥viles permite suavizar la serie temporal y revelar la tendencia subyacente del comercio minorista australiano.
Para este caso, se calcularon dos medidas de suavizamiento complementarias:

SMA (12 meses): promedio m√≥vil simple de un a√±o, que elimina gran parte de las fluctuaciones mensuales.

EMA (6 meses): promedio m√≥vil exponencial de medio a√±o, que asigna mayor peso a los valores recientes.

La Tabla 3 resume los par√°metros de cada m√©todo.

La Figura 2 muestra la comparaci√≥n entre la serie original y las versiones suavizadas, utilizando colores diferenciados

La figura evidencia una tendencia ascendente sostenida en el volumen de ventas minoristas entre 1982 y 2024.
La SMA (12) (l√≠nea verde) muestra un crecimiento continuo con leves pausas durante crisis econ√≥micas, mientras que la EMA (6) (l√≠nea naranja) capta con mayor sensibilidad las desaceleraciones o repuntes de corto plazo.
Ambos m√©todos confirman que la serie presenta una fuerte no estacionaridad en nivel, producto del crecimiento estructural del comercio.

Los promedios m√≥viles son una herramienta fundamental para distinguir la tendencia general de la variabilidad estacional.
Este resultado establece la base para los siguientes an√°lisis, donde se abordar√° la estacionalidad y la autocorrelaci√≥n temporal para identificar los patrones c√≠clicos que caracterizan la serie.



## **Estacionalidad y rezagos (seasonplot, subseries, ACF y descomposici√≥n)**

En una serie temporal, la estacionalidad se refiere a los patrones que se repiten a intervalos regulares, como meses, trimestres o a√±os. Estos ciclos son producto de comportamientos peri√≥dicos (por ejemplo, aumentos de ventas en diciembre o ca√≠das en enero).

F√≥rmulas

**Modelo aditivo:**

$$
Y_t = T_t + S_t + R_t
$$

**Modelo multiplicativo:**

$$
Y_t = T_t \times S_t \times R_t
$$

**Estimaci√≥n de la tendencia (promedio m√≥vil centrado):**

$$
T_t = \frac{1}{m} \sum_{i=-k}^{k} Y_{t+i}
$$

**√çndices estacionales promedio (modelo aditivo):**

$$
S_m = \frac{1}{n} \sum_{j=1}^{n} (Y_{m,j} - T_{m,j})
$$

**√çndices estacionales promedio (modelo multiplicativo):**

$$
S_m = \frac{1}{n} \sum_{j=1}^{n} \frac{Y_{m,j}}{T_{m,j}}
$$

**Recomposici√≥n (modelo aditivo):**

$$
\hat{Y}_t = \hat{T}_t + \hat{S}_t
$$

**Recomposici√≥n (modelo multiplicativo):**

$$
\hat{Y}_t = \hat{T}_t \times \hat{S}_t
$$



En el Retail Turnover Australia, se observa un patr√≥n anual (m = 12), con picos en noviembre‚Äìdiciembre y descensos en enero‚Äìfebrero.
Para analizarlo:

Se genera el Seasonplot (Figura 3) para visualizar la periodicidad.

Se utiliza la ACF (Autocorrelaci√≥n) para confirmar que los picos se repiten cada 12 rezagos.

Se aplica la descomposici√≥n STL para separar tendencia, estacionalidad y residuo.

```{r, message=FALSE, warning=FALSE}
# Estacionalidad y rezagos ===
suppressPackageStartupMessages({
  if (!requireNamespace("forecast", quietly = TRUE)) install.packages("forecast")
  library(forecast)   # ggseasonplot, ggsubseriesplot, ggAcf
  library(dplyr); library(tidyr); library(ggplot2); library(knitr); library(lubridate)
})

# Asegurar objeto ts_y (mensual)
stopifnot(exists("ts_y"), is.ts(ts_y), frequency(ts_y) == 12)

# ---------- Seasonplot: mismo mes a trav√©s de los a√±os ----------
df_season <- tibble(
  fecha = as.Date(time(ts_y), origin = "1970-01-01"),
  valor = as.numeric(ts_y),
  anio  = year(as.Date(time(ts_y), origin = "1970-01-01")),
  mes   = factor(month(as.Date(time(ts_y), origin = "1970-01-01"), label = TRUE, abbr = TRUE),
                 ordered = TRUE)
)

# Figura 3 (versi√≥n completa: todas las curvas)
# Esta versi√≥n es intencionalmente 'cargada' para mostrar el problema de legibilidad.
p_season_full <- ggplot(df_season, aes(x = mes, y = valor, group = anio)) +
  geom_line(color = "#7f7f7f", alpha = 0.35) +
  labs(title = "Figura 3. Estacionalidad anual ‚Äî todas las curvas por a√±o",
       subtitle = "Versi√≥n ilustrativa: la superposici√≥n de ~40 a√±os dificulta la lectura del patr√≥n",
       x = "Mes del a√±o", y = "Turnover (millones de AUD)") +
  theme_light(base_size = 11) +
  theme(plot.title = element_text(face = "bold", size = 13, color = "#333"),
        panel.border = element_rect(color = "#ccc"))
print(p_season_full)

# Figura 3A (√∫ltimos 10 a√±os) 
ult10 <- (max(df_season$anio) - 9):max(df_season$anio)
p_season_10 <- ggplot(filter(df_season, anio %in% ult10),
                      aes(x = mes, y = valor, group = anio, color = factor(anio))) +
  geom_line(linewidth = 0.8, alpha = 0.9) +
  scale_color_viridis_d(name = "A√±o", option = "C", end = 0.9) +
  labs(title = "Figura 3A. Estacionalidad ‚Äî √∫ltimos 10 a√±os",
       subtitle = "Comparaci√≥n clara de perfiles mensuales (solo la d√©cada reciente)",
       x = "Mes del a√±o", y = "Turnover (millones de AUD)") +
  theme_bw(base_size = 11) +
  theme(plot.title = element_text(face = "bold"),
        panel.border = element_rect(color = "#ccc"))
print(p_season_10)

# Figura 3B (por d√©cada: promedio + √∫ltimo a√±o destacado)
df_dec   <- df_season %>% mutate(decada = paste0(floor(anio/10)*10, "s"))
mean_dec <- df_dec %>% group_by(decada, mes) %>%
  summarise(prom = mean(valor, na.rm = TRUE), .groups = "drop")
anio_reciente <- max(df_dec$anio)

p_season_dec <- ggplot(df_dec, aes(mes, valor, group = anio)) +
  geom_line(alpha = 0.25, color = "#7f7f7f") +                              # a√±os de la d√©cada
  geom_line(data = mean_dec, aes(mes, prom, group = 1),                     # promedio d√©cada
            color = "#0072B2", linewidth = 1.1) +
  geom_line(data = subset(df_dec, anio == anio_reciente),                   # √∫ltimo a√±o
            color = "#D55E00", linewidth = 1.1) +
  facet_wrap(~ decada, ncol = 2, scales = "free_y") +
  labs(title = "Figura 3B. Estacionalidad por d√©cada",
       subtitle = "Gris: a√±os de la d√©cada | Azul: promedio mensual | Naranja: √∫ltimo a√±o disponible",
       x = "Mes del a√±o", y = "Turnover (millones de AUD)") +
  theme_light(base_size = 11) +
  theme(plot.title = element_text(face = "bold"),
        strip.background = element_rect(fill = "#f2f2f2"),
        panel.border = element_rect(color = "#ccc"))
print(p_season_dec)


# Subseries: promedio por mes (facetas) 
p_subseries <- ggsubseriesplot(ts_y) +
  labs(
    title    = "Figura 4. Subseries mensuales: patr√≥n promedio por mes",
    subtitle = "Cada panel muestra la serie del mes a trav√©s del tiempo y su promedio",
    x = "A√±o", y = "Turnover (millones de AUD)"
  ) +
  theme_bw(base_size = 11) +
  theme(
    plot.title    = element_text(face = "bold", size = 13, color = "#333"),
    plot.subtitle = element_text(size = 10, color = "#555"),
    axis.title.y  = element_text(color = "#0072B2", face = "bold"),
    panel.border  = element_rect(color = "#ccc")
  )
print(p_subseries)

# ACF: autocorrelaci√≥n (rezagos) 
p_acf <- ggAcf(ts_y) +
  labs(
    title    = "Figura 5. Autocorrelaci√≥n (ACF) de la serie",
    subtitle = "Picos en rezagos m√∫ltiples de 12 meses confirman estacionalidad anual",
    x = "Rezago (meses)", y = "Correlaci√≥n"
  ) +
  theme_bw(base_size = 11) +
  theme(
    plot.title    = element_text(face = "bold", size = 13, color = "#333"),
    plot.subtitle = element_text(size = 10, color = "#555"),
    panel.border  = element_rect(color = "#ccc")
  )
print(p_acf)

#  Descomposici√≥n (STL robusta) 
ts_df <- tibble(fecha = as.Date(time(ts_y), origin = "1970-01-01"),
                valor = as.numeric(ts_y))

# STL en base a ts (monthly)
fit_stl <- stl(ts_y, s.window = "periodic", robust = TRUE)
autoplot(fit_stl) +
  labs(
    title    = "Figura 6. Descomposici√≥n STL: tendencia, estacionalidad y residuo",
    subtitle = "STL robusta con estacionalidad peri√≥dica (mensual)",
    x = "Tiempo"
  ) +
  theme_bw(base_size = 11) +
  theme(
    plot.title    = element_text(face = "bold", size = 13, color = "#333"),
    plot.subtitle = element_text(size = 10, color = "#555"),
    panel.border  = element_rect(color = "#ccc")
  )

# Tabla: medias por mes y ranking 
mes_tbl <- ts_df |>
  mutate(mes = month(fecha, label = TRUE, abbr = TRUE)) |>
  group_by(mes) |>
  summarize(`Promedio mensual` = round(mean(valor, na.rm = TRUE), 1), .groups = "drop") |>
  arrange(desc(`Promedio mensual`))

knitr::kable(
  mes_tbl,
  caption = "Tabla 5. Promedio del turnover por mes (ranking descendente).",
  align = "c"
)

```

Seasonplot (Figura 3)

El gr√°fico estacional traza, para cada a√±o, la evoluci√≥n a lo largo de los 12 meses.
Se observa un patr√≥n altamente repetitivo: incrementos hacia el cierre de a√±o y ca√≠das posteriores, evidencia clara de estacionalidad mensual. La superposici√≥n de curvas similares entre a√±os indica que el patr√≥n es estable y persistente.

Para evitar la sobrecarga visual del seasonplot con todos los a√±os, se presentan dos vistas complementarias:

Figura 3A (√∫ltimos 10 a√±os): la estacionalidad reciente es n√≠tida; se mantiene el pico en noviembre‚Äìdiciembre y la ca√≠da en enero‚Äìfebrero.

Figura 3B (facetas por d√©cada): el promedio mensual de cada d√©cada (l√≠nea azul) confirma la estabilidad del patr√≥n anual, mientras que la curva del √∫ltimo a√±o (naranja) permite contrastar el presente con su contexto hist√≥rico.

La serie exhibe estacionalidad anual fuerte y persistente con m√°ximos en los meses de cierre de a√±o.


Subseries mensuales (Figura 4)

Las subseries muestran cada mes como una serie independiente en el tiempo, junto con su promedio.
Los paneles permiten identificar qu√© meses presentan niveles sistem√°ticamente altos (p. ej., noviembre‚Äìdiciembre) y cu√°les tienden a ser bajos (p. ej., enero‚Äìfebrero).
Esto refuerza la lectura del seasonplot con una visi√≥n mes a mes.


Autocorrelaci√≥n (Figura 5)

La ACF exhibe picos significativos en rezagos de 12, 24, 36‚Ä¶ meses, lo cual confirma formalmente la estacionalidad anual. Adem√°s, la persistencia de autocorrelaci√≥n en rezagos cortos indica que la serie no es ruido blanco y posee memoria (dependencia temporal).

Descomposici√≥n STL (Figura 6)

La descomposici√≥n STL separa la serie en tendencia, estacionalidad y residuo.

* La tendencia muestra el crecimiento estructural de largo plazo.

* La estacionalidad mensual es marcada y relativamente estable.

* El residuo concentra la variaci√≥n no explicada (shocks espec√≠ficos, ruido).


La Tabla 5 resume el promedio hist√≥rico por mes y lo ordena de mayor a menor, facilitando referenciar los picos estacionales en el texto.

La combinaci√≥n de seasonplot, subseries, ACF y STL confirma que la serie presenta tendencia creciente y estacionalidad anual fuerte.
Estos hallazgos orientan las transformaciones para el modelado: diferenciaci√≥n regular (Œî) para estabilizar tendencia y, de ser necesario, diferenciaci√≥n estacional (Œî‚ÇÅ‚ÇÇ) para remover el componente mensual antes de ajustes ARIMA/ETS.



## **Diferencias Œî y Œî‚ÇÅ‚ÇÇ (rezagos y estabilizaci√≥n)**

El proceso de diferenciaci√≥n busca eliminar la tendencia y la estacionalidad de una serie temporal, con el fin de obtener estacionariedad (una serie con media y varianza constantes a lo largo del tiempo).

Existen dos tipos de diferencias:

* Diferencia regular (Œî): elimina la tendencia.

* Diferencia estacional (Œî12): elimina la estacionalidad anual (para frecuencia mensual). 

F√≥rmula 

**Diferencia regular (Œî):**

$$
\Delta Y_t = Y_t - Y_{t-1}
$$

**Diferencia estacional (Œî‚ÇÅ‚ÇÇ):**

$$
\Delta_{12} Y_t = Y_t - Y_{t-12}
$$

**Doble diferencia combinada (ŒîŒî‚ÇÅ‚ÇÇ):**

$$
\Delta \Delta_{12} Y_t = (Y_t - Y_{t-1}) - (Y_{t-12} - Y_{t-13})
$$

**Operador de diferencia general:**

$$
\nabla^d Y_t = (1 - B)^d Y_t
$$

En el Retail Turnover Australia:

La diferencia regular (Œî) reduce la tendencia.

La diferencia estacional (Œî12) elimina el patr√≥n anual.

La combinaci√≥n ŒîŒî12 produce una serie estacionaria, adecuada para modelar con ARIMA o SARIMA.

Nuestro objetivo es mostrar c√≥mo la primera diferencia (Œî) y la diferencia estacional (Œî‚ÇÅ‚ÇÇ) remueven tendencia y estacionalidad, respectivamente, y comprobarlo visualmente y con ACF.


```{r, message=FALSE, warning=FALSE}

#Diferencias Œî y Œî‚ÇÅ‚ÇÇ
library(ggplot2); library(dplyr); library(forecast); library(knitr)

# 6.1 Construcci√≥n de diferencias
ts_d1   <- diff(ts_y, lag = 1)          # Œî x_t = x_t - x_{t-1}
ts_d12  <- diff(ts_y, lag = 12)         # Œî‚ÇÅ‚ÇÇ x_t = x_t - x_{t-12}
ts_d1d12 <- diff(ts_d12, lag = 1)       # Œî(Œî‚ÇÅ‚ÇÇ x_t)  -> candidata a estacionaria

# Pasar a data.frames para graficar con ggplot
as_df <- function(z) data.frame(
  fecha = as.Date(time(z), origin = "1970-01-01"),
  valor = as.numeric(z)
)

df_d1    <- as_df(ts_d1)
df_d12   <- as_df(ts_d12)
df_d1d12 <- as_df(ts_d1d12)

# 6.2 Figuras de las diferencias
g_base <- function(dat, titulo, subtit, ylab){
  ggplot(dat, aes(fecha, valor)) +
    geom_line(color = "#0072B2", linewidth = 0.6) +
    labs(title = titulo, subtitle = subtit, x = "Tiempo", y = ylab) +
    theme_bw(base_size = 11) +
    theme(
      plot.title    = element_text(face = "bold", size = 13, color = "#333"),
      plot.subtitle = element_text(size = 10, color = "#555"),
      axis.title.y  = element_text(color = "#0072B2", face = "bold"),
      panel.border  = element_rect(color = "#ccc")
    )
}

print(g_base(df_d1,
             "Figura 7. Primera diferencia (Œî)",
             "Elimina gran parte de la tendencia (serie con media m√°s estable).",
             expression(Delta~x[t])))

print(g_base(df_d12,
             "Figura 8. Diferencia estacional (Œî‚ÇÅ‚ÇÇ)",
             "Elimina el patr√≥n anual repetitivo (estacionalidad).",
             expression(Delta[12]~x[t])))

print(g_base(df_d1d12,
             "Figura 9. Diferencia combinada Œî¬∑Œî‚ÇÅ‚ÇÇ",
             "Primero diferencia estacional, luego primera diferencia ‚Üí candidata a estacionaria.",
             expression(Delta~Delta[12]~x[t])))

# 6.3 ACF de las diferencias (para confirmar)
acf_pl <- function(z, titulo){
  ggAcf(z) +
    labs(title = titulo, x = "Rezago (meses)", y = "Correlaci√≥n") +
    theme_bw(base_size = 11) +
    theme(
      plot.title = element_text(face = "bold", size = 13, color = "#333"),
      panel.border = element_rect(color = "#ccc")
    )
}
print(acf_pl(ts_d1,   "Figura 10. ACF de Œî"))
print(acf_pl(ts_d12,  "Figura 11. ACF de Œî‚ÇÅ‚ÇÇ"))
print(acf_pl(ts_d1d12,"Figura 12. ACF de Œî¬∑Œî‚ÇÅ‚ÇÇ"))

# 6.4 (Opcional) Mini-tabla de varianzas para mostrar estabilizaci√≥n
stab_tbl <- data.frame(
  Serie = c("Nivel", "Œî", "Œî‚ÇÅ‚ÇÇ", "Œî¬∑Œî‚ÇÅ‚ÇÇ"),
  Varianza = round(c(var(ts_y, na.rm=TRUE),
                     var(ts_d1, na.rm=TRUE),
                     var(ts_d12, na.rm=TRUE),
                     var(ts_d1d12, na.rm=TRUE)), 2)
)
knitr::kable(stab_tbl,
             caption = "Tabla 6. Varianza por transformaci√≥n: evidencia de estabilizaci√≥n tras diferenciar.",
             align = "c")

```


Œî (Figura 7): remueve la tendencia, acercando la serie a media estable, aunque mantiene restos estacionales.

Œî‚ÇÅ‚ÇÇ (Figura 8): remueve la estacionalidad anual (patr√≥n de 12 meses), pero a√∫n puede persistir una deriva de largo plazo.

Œî¬∑Œî‚ÇÅ‚ÇÇ (Figura 9): combinando ambas se obtiene una serie candidata a estacionaria; las ACF (Figuras 10‚Äì12) muestran que los picos estacionales se reducen dr√°sticamente y la dependencia a largo plazo se aten√∫a.

Tabla 6: la varianza disminuye tras diferenciar, lo que apoya la estabilizaci√≥n.

Para modelar esta serie con enfoques ARIMA estacionales, una especificaci√≥n (d = 1, D = 1, m = 12) es un punto de partida razonable, sujeto a verificaci√≥n con diagn√≥sticos formales (AICc, pruebas de ra√≠z unitaria y residuales del modelo).


## **Conclusiones unidad 2**

El an√°lisis exploratorio de la serie mensual Australia Monthly Retail Turnover (1982‚Äì2024) permiti√≥ caracterizar su comportamiento hist√≥rico mediante t√©cnicas gr√°ficas y estad√≠sticas que revelan su estructura temporal y estacional.

1. Identificaci√≥n del patr√≥n general

A partir de los promedios m√≥viles (SMA(12) y EMA(6)), se observ√≥ una tendencia creciente sostenida en el volumen de ventas minoristas, con incrementos marcados desde mediados de los a√±os noventa y aceleraciones notorias a partir de 2010.
Esta tendencia indica un crecimiento estructural del comercio minorista australiano, vinculado al aumento del consumo y la expansi√≥n econ√≥mica.

2. Estructura estacional

El an√°lisis mediante seasonplot, subseries y promedios mensuales mostr√≥ un patr√≥n estacional anual fuerte y estable, con picos de ventas en noviembre‚Äìdiciembre (√©poca de fin de a√±o) y ca√≠das en enero‚Äìfebrero.
Este comportamiento fue confirmado estad√≠sticamente mediante la funci√≥n de autocorrelaci√≥n (ACF), con picos significativos en m√∫ltiplos de 12 rezagos.

3. Descomposici√≥n y componentes

La descomposici√≥n STL robusta separ√≥ la serie en sus tres componentes principales:

Tendencia: crecimiento constante en el largo plazo.

Estacionalidad: patr√≥n mensual repetitivo.

Residuo: fluctuaciones irregulares atribuibles a choques econ√≥micos o eventos espec√≠ficos.
Los componentes de tendencia y estacionalidad resultaron dominantes, lo cual evidenci√≥ la necesidad de aplicar transformaciones previas al modelado.

4. Preprocesamiento para el modelado

El proceso de diferenciaci√≥n regular y estacional (Œî y Œî‚ÇÅ‚ÇÇ) permiti√≥ estabilizar la serie al eliminar la tendencia y la estacionalidad, logrando una estructura m√°s adecuada para el ajuste de modelos ARIMA estacionales (SARIMA).
Este paso constituye la base del preprocesamiento y visualizaci√≥n abordado en la Unidad 3.


# Unidad 3: Preprocesamiento y visualizaci√≥n

En esta unidad se contin√∫a el an√°lisis desarrollado en la Unidad 2, profundizando en las etapas de preprocesamiento de datos y visualizaci√≥n aplicadas a la serie mensual Australia Monthly Retail Turnover (1982‚Äì2024). El objetivo es garantizar que la serie cumpla con las condiciones necesarias para su posterior modelado, particularmente en la identificaci√≥n de componentes estructurales y la estabilizaci√≥n de la varianza y la media.

A trav√©s de t√©cnicas estad√≠sticas y gr√°ficas, se analizan nuevamente los patrones de tendencia y estacionalidad, la descomposici√≥n de la serie y las transformaciones requeridas para alcanzar la estacionariedad, utilizando funciones de diferenciaci√≥n regular y estacional (Œî y Œî‚ÇÅ‚ÇÇ). Estas operaciones forman parte esencial del preprocesamiento, al eliminar dependencias sistem√°ticas y preparar la informaci√≥n para la estimaci√≥n de modelos ARIMA estacionales (SARIMA).

El proceso descrito integra la manipulaci√≥n de datos, la verificaci√≥n de supuestos y la interpretaci√≥n visual como base para la comprensi√≥n del comportamiento temporal de las ventas minoristas australianas, asegurando una estructura adecuada y confiable para las fases siguientes de modelado y validaci√≥n.



```{r, message=FALSE, warning=FALSE}
#| message: FALSE
#| warning: FALSE
suppressPackageStartupMessages({
  library(forecast); library(tseries); library(ggplot2)
  library(knitr);    library(kableExtra)
})

# Estilos
gg_std <- theme_minimal(base_size = 11) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(face = "bold"),
    plot.subtitle = element_text(color = "grey30"),
    panel.grid.minor = element_blank()
  )

kbl_std <- function(df, caption = NULL, digits = 3) {
  knitr::kable(df, caption = caption, align = "c", digits = digits) |>
    kableExtra::kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
}

```

## **Transformaci√≥n Box-Cox + Descomposici√≥n STL**

La transformaci√≥n Box‚ÄìCox se utiliza para estabilizar la varianza y mejorar la normalidad de una serie temporal antes del modelado.

F√≥rmula:

$$
Y'_t =
\begin{cases}
\frac{Y_t^{\lambda} - 1}{\lambda}, & \text{si } \lambda \neq 0 \\
\ln(Y_t), & \text{si } \lambda = 0
\end{cases}
$$
ùëåùë° es el valor original de la serie,

ùëåùë° es la serie transformada,

ùúÜ es el par√°metro que controla el grado de transformaci√≥n (estimado con BoxCox.lambda()).

Interpretaci√≥n pr√°ctica:

Si ùúÜ‚âà1, no es necesaria la transformaci√≥n.

Si ùúÜ<1, se recomienda aplicar la transformaci√≥n (reduce la dispersi√≥n).

La descomposici√≥n STL permite expresar una serie temporal ùëåùë°como la suma de tres componentes:


$$Y_t = T_t + S_t + R_t$$

donde:

ùëáùë° es la tendencia,

ùëÜùë° la estacionalidad,

ùëÖùë° el residuo o componente irregular.

El m√©todo STL aplica suavizamiento LOESS para estimar cada componente, permitiendo manejar estacionalidad no constante y valores at√≠picos.

El prop√≥sito es separar los efectos estructurales (tendencia y estacionalidad) de los componentes aleatorios, facilitando el an√°lisis de estacionariedad.

```{r, message=FALSE, warning=FALSE}

stopifnot(exists("ts_y"), is.ts(ts_y), frequency(ts_y) == 12)

lambda_bc <- BoxCox.lambda(ts_y)
usar_bc   <- abs(lambda_bc - 1) > 0.1

cat("Œª (Box-Cox) estimado:", round(lambda_bc, 3), "\n")
cat("¬øAplicar transformaci√≥n? ", ifelse(usar_bc, "S√≠ (|Œª‚àí1|>0.1)", "No (Œª‚âà1)"), "\n")

serie_bc <- if (usar_bc) BoxCox(ts_y, lambda_bc) else ts_y

stl_obj <- stl(serie_bc, s.window = "periodic", robust = TRUE)

print(
  autoplot(stl_obj) +
    labs(
      title = "Figura 13. Descomposici√≥n STL de la serie mensual",
      subtitle = if (usar_bc)
        paste0("Aplicando transformaci√≥n Box‚ÄìCox (Œª = ", round(lambda_bc,3), ")")
      else
        "Sin transformaci√≥n Box‚ÄìCox",
      x = "Tiempo", y = NULL
    ) + gg_std
)

if (usar_bc) {
  # Crear tabla de varianzas con formato num√©rico y sin notaci√≥n cient√≠fica
  var_tbl <- data.frame(
    Serie = c("Original", paste0("Box-Cox (lambda = ", round(lambda_bc, 3), ")")),
    Varianza = formatC(
      c(var(ts_y, na.rm = TRUE), var(serie_bc, na.rm = TRUE)),
      format = "f", digits = 2, big.mark = ","
    )
  )

  knitr::kable(
    var_tbl,
    caption = "Tabla 7. Comparaci√≥n de varianzas: original vs transformada (criterio de estabilizaci√≥n).",
    align = "c",
    booktabs = TRUE
  ) %>%
    kableExtra::kable_styling(
      full_width = FALSE,
      position = "center",
      bootstrap_options = c("striped", "hover", "condensed")
    )
}

```

Figura 13. Descomposici√≥n STL de la serie mensual

La descomposici√≥n STL (con transformaci√≥n Box‚ÄìCox, Œª = 0.196) permite analizar la estructura interna de la serie mensual Australia Monthly Retail Turnover y distinguir sus componentes principales:

Data (serie original transformada): muestra un comportamiento creciente a lo largo del tiempo, lo que confirma la presencia de una tendencia positiva estructural en las ventas minoristas australianas.

Trend (tendencia): evidencia un incremento sostenido, especialmente a partir del a√±o 2000, reflejando el crecimiento econ√≥mico y la expansi√≥n del consumo en el pa√≠s.

Seasonal (estacionalidad): presenta un patr√≥n c√≠clico muy regular y estable, con picos pronunciados en los meses de noviembre y diciembre (temporada alta por fin de a√±o) y ca√≠das en enero‚Äìfebrero.

Remainder (residuo): agrupa las fluctuaciones irregulares no explicadas por los componentes sistem√°ticos, asociadas a choques econ√≥micos o cambios coyunturales del mercado.

Tabla 7. Comparaci√≥n de varianzas: original vs transformada

La varianza de la serie se redujo dr√°sticamente tras aplicar la transformaci√≥n Box‚ÄìCox, pasando de aproximadamente 1.96√ó10‚Å∏ a 18.2.

Esto indica que la transformaci√≥n logr√≥ estabilizar la variabilidad de la serie, uno de los requisitos para que el modelo ARIMA (o SARIMA) funcione correctamente.

La estimaci√≥n del par√°metro Œª = 0.196 confirma que una transformaci√≥n de tipo ra√≠z o logar√≠tmica era necesaria para homogeneizar la escala de las observaciones.

La aplicaci√≥n de la transformaci√≥n Box‚ÄìCox fue justificada y efectiva, ya que permiti√≥ controlar la heterocedasticidad (varianza no constante) y dejar la serie en condiciones m√°s adecuadas para el an√°lisis de estacionariedad y la posterior estimaci√≥n del modelo SARIMA.


## **Fuerza estacional + recomendaciones de diferenciaci√≥n**


La fuerza de estacionalidad cuantifica qu√© tan dominante es el componente estacional frente a la variaci√≥n total de la serie. Se calcula a partir de la descomposici√≥n STL mediante la siguiente f√≥rmula:

$$F_s = 1 - \frac{Var(R_t)}{Var(S_t + R_t)}$$


```{r, message=FALSE, warning=FALSE}

suppressPackageStartupMessages({ library(forecast); library(knitr); library(kableExtra) })

# --- Fuerza de estacionalidad (a partir del STL ya calculado) ---
stopifnot(exists("stl_obj"), exists("serie_bc"))

comp   <- stl_obj$time.series
var_r  <- var(comp[, "remainder"], na.rm = TRUE)
var_sr <- var(comp[, "seasonal"] + comp[, "remainder"], na.rm = TRUE)
fuerza_est <- max(0, 1 - var_r/var_sr)  # 0 a 1 (mayor = estacionalidad m√°s fuerte)

# --- Recomendaciones autom√°ticas de diferencias (regular y estacional) ---
d_rec <- ndiffs(serie_bc, alpha = 0.05, test = "adf")
D_rec <- nsdiffs(serie_bc, m = 12)

# --- Tabla 8: estacionalidad y recomendaciones ---
tab8 <- data.frame(
  Indicador = c("Fuerza de estacionalidad (0‚Äì1)", "d recomendado", "D recomendado (m=12)"),
  Valor     = c(round(fuerza_est, 3), d_rec, D_rec)
)

knitr::kable(
  tab8,
  caption = "Tabla 8. Medida de estacionalidad y recomendaciones de diferenciaci√≥n.",
  align = "c",
  booktabs = TRUE
) |>
  kableExtra::kable_styling(full_width = FALSE, position = "center",
                            bootstrap_options = c("striped","hover","condensed"))

```


De acuerdo a los resultados de la Tabla 8 La fuerza estacional elevada (0.968) y las recomendaciones ùëë=1y ùê∑=1 confirman que la serie Australia Monthly Retail Turnover presenta una estructura estacional dominante y una tendencia creciente, por lo que es necesario aplicar una doble diferenciaci√≥n (regular y estacional).

Esto garantiza que la serie cumpla con el supuesto de estacionariedad requerido para la estimaci√≥n del modelo SARIMA(p,d,q)(P,D,Q)[12] en la siguiente unidad.


## **Doble diferenciaci√≥n (regular y estacional)**

EL objetivo es remover tendencia y patr√≥n estacional para lograr estacionariedad.

F√≥rmulas:

Diferencia regular:
$$\nabla Y_t = Y_t - Y_{t-1}$$

Diferencia estacional (m=12):
$$\nabla_{12} Y_t = Y_t - Y_{t-12}$$

Combinada (aplicando primero estacional y luego regular):

$$\nabla \nabla_{12} Y_t = (Y_t - Y_{t-12}) - (Y_{t-1} - Y_{t-13})$$

En esta unidad usamos los √≥rdenes recomendados: d = 1 y D = 1.


```{r, message=FALSE, warning=FALSE}
stopifnot(exists("serie_bc"))   # Serie (posiblemente Box‚ÄìCox) y freq=12
d_rec <- 1L
D_rec <- 1L

y_diff <- serie_bc
if (D_rec > 0) y_diff <- diff(y_diff, lag = 12, differences = D_rec)
if (d_rec > 0) y_diff <- diff(y_diff, differences = d_rec)

# Figura 14. Serie transformada y doblemente diferenciada (Œî¬∑Œî12)
print(
  autoplot(y_diff) +
    labs(
      title = "Figura 14. Serie transformada y diferenciada (Œî¬∑Œî‚ÇÅ‚ÇÇ)",
      subtitle = "Ordenes aplicados: d = 1, D = 1 (m = 12)",
      x = "Tiempo", y = "Escala transformada"
    ) + gg_std
)
```

En la Figura 14 vemos que despu√©s de aplicar las diferencias regular (ùëë=1) y estacional (D=1,m=12), la serie Australia Monthly Retail Turnover muestra un comportamiento claramente distinto al de la versi√≥n original.

* La serie se oscila alrededor de la media cero, lo que sugiere que la tendencia fue eliminada.

* La varianza se mantiene relativamente constante a lo largo del tiempo, indicando que el proceso de diferenciaci√≥n logr√≥ estabilizar la escala.

* Los picos irregulares observados alrededor del a√±o 2000 podr√≠an corresponder a eventos econ√≥micos puntuales (choques transitorios), pero no reflejan una tendencia sistem√°tica.

* No se aprecian patrones c√≠clicos definidos ni repetitivos, lo que evidencia que la estacionalidad fue removida con √©xito.

## **Prueba ADF antes/despu√©s**

El objetivo es evidenciar estacionariedad tras la doble diferenciaci√≥n.

Modelo (forma com√∫n de la ADF):
$$\Delta Y_t = \alpha + \beta t + \gamma Y_{t-1} + \sum_{i=1}^{p}\phi_i \, \Delta Y_{t-i} + \varepsilon_t$$
Hip√≥tesis:
$$H_0: \gamma = 0 \quad (\text{ra√≠z unitaria, no estacionaria}) \qquad H_1: \gamma < 0 \quad (\text{estacionaria})$$
Criterio: p-value < 0.05 ‚Üí evidencia de estacionariedad.

```{r, message=FALSE, warning=FALSE}
suppressPackageStartupMessages({ library(tseries); library(knitr); library(kableExtra) })

adf_before <- adf.test(serie_bc)
adf_after  <- adf.test(na.omit(y_diff))

# Crear tabla 
tab9 <- data.frame(
  `Etapa` = c("Antes (serie usada en STL)", "Despu√©s de $\\Delta¬∑\\Delta_{12}$"),
  `p-value ADF` = formatC(c(adf_before$p.value, adf_after$p.value),
                          format = "f", digits = 3),
  `Estacionaria` = c(adf_before$p.value < 0.05, adf_after$p.value < 0.05)
)

knitr::kable(
  tab9,
  caption = "Tabla 9. Prueba ADF antes y despu√©s de la doble diferenciaci√≥n.",
  align = "c", booktabs = TRUE, escape = FALSE
) |>
  kableExtra::kable_styling(full_width = FALSE, position = "center",
                            bootstrap_options = c("striped","hover","condensed"))
```

En la Tabla 9 podemos apreciar que en ambos casos el p-value (0.01) es menor que 0.05, por lo que se rechaza la hip√≥tesis nula (H‚ÇÄ) de ra√≠z unitaria.

Esto significa que tanto la serie transformada con Box‚ÄìCox como la doblemente diferenciada son estacionarias en t√©rminos de media y varianza.

Sin embargo, el resultado ‚ÄúTRUE‚Äù en ambas etapas puede deberse a que el Box‚ÄìCox ya estabiliz√≥ gran parte de la varianza, y la doble diferenciaci√≥n termin√≥ de eliminar la tendencia residual y los ciclos anuales.

La prueba ADF confirma que la serie procesada cumple con el supuesto de estacionariedad, lo cual valida el preprocesamiento y permite avanzar al an√°lisis de autocorrelaciones (ACF/PACF) para determinar los √≥rdenes del modelo SARIMA(p,d,q)(P,D,Q)[12].


## **Validaci√≥n visual: ACF y PACF**

Objetivo: verificar la estacionariedad y la estructura de correlaci√≥n temporal en la serie diferenciada.

La funci√≥n de autocorrelaci√≥n (ACF) mide la relaci√≥n entre valores separados por un rezago k:

$$\rho_k = \frac{\text{Cov}(Y_t, Y_{t-k})}{\text{Var}(Y_t)}$$
donde:

* $\rho_k$ es el coeficiente de autocorrelaci√≥n en el rezago k,
* $Y_t$ es el valor de la serie en el tiempo t.

En una serie estacionaria, la ACF decae r√°pidamente hacia cero y no muestra patrones sistem√°ticos.

La autocorrelaci√≥n parcial (PACF) mide la correlaci√≥n directa entre $Y_t$ y $Y_{t-k}$, eliminando los efectos de los rezagos intermedios.Ambas funciones ayudan a:
- Confirmar la estacionariedad de la serie diferenciada.
- Sugerir los √≥rdenes (p, q) y (P, Q) para el modelo SARIMA.


```{r, message=FALSE, warning=FALSE}
Acf(na.omit(y_diff),
    main = "Figura 15. Funci√≥n de Autocorrelaci√≥n (ACF) - Serie diferenciada Œî¬∑Œî‚ÇÅ‚ÇÇ")

# Figura 16. PACF de la serie Œî¬∑Œî‚ÇÅ‚ÇÇ
Pacf(na.omit(y_diff),
     main = "Figura 16. Funci√≥n de Autocorrelaci√≥n Parcial (PACF) - Serie diferenciada Œî¬∑Œî‚ÇÅ‚ÇÇ")
```


Figura 15. Funci√≥n de Autocorrelaci√≥n (ACF)

La funci√≥n de autocorrelaci√≥n de la serie diferenciada (Œî¬∑Œî‚ÇÅ‚ÇÇ) muestra una r√°pida ca√≠da de las correlaciones despu√©s de los primeros rezagos, lo que indica que no existe dependencia temporal prolongada.
Los picos en los primeros lags son bajos y dentro del intervalo de confianza (l√≠neas azules), lo que confirma que no hay estructura de tendencia ni estacionalidad remanente.
Adem√°s, los rezagos en m√∫ltiplos de 12 no presentan un patr√≥n fuerte, evidenciando que la diferenciaci√≥n estacional elimin√≥ efectivamente la periodicidad anual observada en la serie original.


Figura 16. Funci√≥n de Autocorrelaci√≥n Parcial (PACF)

En la PACF, los picos significativos se concentran en los primeros rezagos (lag 1), mientras que los dem√°s coeficientes se encuentran dentro de las bandas de confianza.
Este patr√≥n ‚Äîun corte abrupto en la PACF y una ACF que decae gradualmente‚Äî sugiere la presencia de un t√©rmino autorregresivo (AR) de primer orden.


Los resultados combinados de las Figuras 15 y 16 confirman que la serie diferenciada ya cumple con el supuesto de estacionariedad, con media constante, varianza homog√©nea y ausencia de patrones estacionales o tendencias residuales.
De acuerdo con los patrones observados, un modelo inicial adecuado para evaluar ser√≠a:


SARIMA(1,1,1)(0,1,1)12
	

Este modelo integra un componente autorregresivo y otro de media m√≥vil en la parte regular, junto con una diferencia y un t√©rmino estacional de orden anual.


El modelo SARIMA (Seasonal ARIMA) ampl√≠a el ARIMA tradicional incorporando componentes estacionales.

Su formula general es:


$$SARIMA(p,d,q)(P,D,Q)_{m}$$

donde:
* $p$  ‚Üí orden autorregresivo (AR),
* $d$  ‚Üí n√∫mero de diferencias regulares,
* $q$  ‚Üí orden de media m√≥vil (MA),
* $P$  ‚Üí orden autorregresivo estacional,
* $D$  ‚Üí n√∫mero de diferencias estacionales,
* $Q$  ‚Üí orden de media m√≥vil estacional,
* $m$  ‚Üí periodicidad (12 para datos mensuales).

Este checklist resume las decisiones y verificaciones realizadas en el preprocesamiento.

```{r, message=FALSE, warning=FALSE}
check_tbl <- data.frame(
  `Aspecto evaluado` = c(
    "Transformacion Box-Cox aplicada",
    "Diferencias aplicadas (d, D)",
    "Prueba ADF final (p-value < 0.05)",
    "Confirmacion visual (ACF / PACF)",
    "Serie lista para modelado SARIMA"
  ),
  `Resultado / Evidencia` = c(
    if (exists("lambda_bc") && abs(lambda_bc - 1) > 0.1)
      paste0("Si, lambda = ", round(lambda_bc, 3))
    else
      "No necesaria (lambda ‚âà 1)",
    "d = 1, D = 1 (m = 12)",
    ifelse(adf_after$p.value < 0.05, "Si - estacionaria", "No - requiere mas diferencias"),
    "ACF y PACF confirman estacionariedad y estructura AR(1)/MA(1)",
    ifelse(adf_after$p.value < 0.05, "Si - lista para modelar", "Ajustar diferenciacion")
  )
)

knitr::kable(
  check_tbl,
  caption = "Tabla 10. Checklist final de preprocesamiento para el modelo SARIMA(p,d,q)(P,D,Q)[12].",
  align = "c",
  booktabs = TRUE,
  escape = FALSE
) |>
  kableExtra::kable_styling(full_width = FALSE, position = "center",
                            bootstrap_options = c("striped","hover","condensed"))
```


La Tabla 10 resume los pasos y comprobaciones realizados durante el preprocesamiento de la serie mensual Australia Monthly Retail Turnover (1982‚Äì2024):

| **Aspecto evaluado** | **Interpretaci√≥n** |
|:-------------|:----------------|
| **Transformaci√≥n Box-Cox aplicada** | Se aplic√≥ la transformaci√≥n Box-Cox con Œª = 0.196, lo que redujo significativamente la varianza y estabiliz√≥ la escala de la serie. Esta correcci√≥n permiti√≥ controlar la heterocedasticidad y cumplir con los supuestos de varianza constante requeridos por los modelos ARIMA/SARIMA. |
| **Diferencias aplicadas (d, D)** | La combinaci√≥n de d = 1 y D = 1 (m = 12) elimin√≥ tanto la tendencia como el patr√≥n estacional anual, dejando la serie centrada en torno a una media estable. |
| **Prueba ADF final (p-value < 0.05)** | Con un p-value = 0.010, se rechaza la hip√≥tesis nula de ra√≠z unitaria. La serie presenta evidencia estad√≠stica de estacionariedad despu√©s del proceso de diferenciaci√≥n. |
| **Confirmaci√≥n visual (ACF / PACF)** | Los gr√°ficos ACF y PACF muestran un r√°pido decaimiento de las correlaciones, sin patrones peri√≥dicos marcados, lo que confirma la estacionariedad y sugiere una estructura AR(1)/MA(1) de bajo orden. |
| **Serie lista para modelado SARIMA** | La serie procesada cumple los supuestos de estacionariedad, por lo que est√° lista para la estimaci√≥n del modelo SARIMA(1,1,1)(0,1,1)[12] como punto de partida para la siguiente unidad. |

## **Conclusiones unidad 3**

El preprocesamiento realizado en la Unidad 3 permiti√≥ consolidar la preparaci√≥n de la serie mensual Australia Monthly Retail Turnover (1982‚Äì2024) para su futura modelaci√≥n mediante t√©cnicas SARIMA. A trav√©s de transformaciones estad√≠sticas y validaciones gr√°ficas, se garantiz√≥ que la serie cumpliera los supuestos de estacionariedad, condici√≥n fundamental para el an√°lisis de series de tiempo.

En primer lugar, la aplicaci√≥n de la transformaci√≥n Box‚ÄìCox (Œª = 0.196) redujo de manera significativa la varianza y estabiliz√≥ la escala, mejorando la homogeneidad de los datos. Posteriormente, la doble diferenciaci√≥n (d = 1, D = 1, m = 12) elimin√≥ la tendencia y los patrones estacionales anuales, lo cual se reflej√≥ en una serie con media constante y comportamiento aleatorio alrededor del cero.

La prueba ADF (p-value = 0.01) confirm√≥ estad√≠sticamente que la serie diferenciada es estacionaria, mientras que el an√°lisis visual de las funciones ACF y PACF evidenci√≥ la ausencia de autocorrelaciones prolongadas y la presencia de picos iniciales compatibles con componentes AR(1) y MA(1). Estos resultados validan el correcto preprocesamiento de los datos y orientan la estructura base para la estimaci√≥n del modelo.

Finalmente, los resultados obtenidos en el checklist de preprocesamiento (Tabla 10) verifican que la serie est√° lista para su modelado. Como punto de partida, se recomienda evaluar el modelo SARIMA(1,1,1)(0,1,1)[12], el cual integrar√° los componentes identificados y permitir√° realizar pron√≥sticos robustos sobre el comportamiento futuro de las ventas minoristas australianas.

## **Referencias**

- Universidad Javeriana Cali (2025). *Material del curso An√°lisis de Series de Tiempo ‚Äî Unidad 2: Estructura de los datos en series de tiempo*. Aula Digital PUJ Cali.

- Kaggle (2023). *Australia Monthly Retail Turnover Data*. Generado de [https://www.kaggle.com/datasets/kanyaweechomming101/australia-monthly-retail-turnover-data](https://www.kaggle.com/datasets/kanyaweechomming101/australia-monthly-retail-turnover-data).

- Hyndman, R. J, & Athanasopoulos, G. (2021). *Forecasting: Principles and Practice*. Generado de [https://otexts.com/fpp3/](https://otexts.com/fpp3/)


# Unidad 4: Metodolog√≠a Holter-Winter y suavizamiento a la variable tiempo

En esta secci√≥n aplicamos el m√©todo de **Holt‚ÄìWinters** a la serie, se compara aditivo vs. multiplicativo y se valida con una partici√≥n temporal (train/test), 
reportando m√©tricas y pron√≥sticos a 12 meses.


**Holt-Winters (suavizamiento exponencial estacional)**  
 
Para frecuencia \(m = 12\).

**Aditivo:**
$$
\begin{aligned}
\ell_t &= \alpha(y_t - s_{t-m}) + (1-\alpha)(\ell_{t-1}+b_{t-1}) \\
b_t    &= \beta(\ell_t - \ell_{t-1}) + (1-\beta)b_{t-1} \\
s_t    &= \gamma(y_t - \ell_t) + (1-\gamma)s_{t-m} \\
\hat{y}_{t+h} &= \ell_t + hb_t + s_{t-m+h_m}
\end{aligned}
$$

**Multiplicativo:**
$$
\begin{aligned}
\ell_t &= \alpha\frac{y_t}{s_{t-m}} + (1-\alpha)(\ell_{t-1}+b_{t-1}) \\
b_t    &= \beta(\ell_t - \ell_{t-1}) + (1-\beta)b_{t-1} \\
s_t    &= \gamma\frac{y_t}{\ell_t} + (1-\gamma)s_{t-m} \\
\hat{y}_{t+h} &= (\ell_t + hb_t)s_{t-m+h_m}
\end{aligned}
$$

donde \( \alpha, \beta, \gamma \in (0,1) \) son par√°metros de suavizamiento;  
\(\ell_t\) es el **nivel**, \(b_t\) la **tendencia**, y \(s_t\) la **estacionalidad**.


```{r, message=FALSE, warning=FALSE}
# Paquetes necesarios
suppressPackageStartupMessages({
  library(forecast)   # hw(), HoltWinters(), forecast(), accuracy()
  library(ggplot2)
  library(dplyr)
  library(lubridate)
  library(knitr)
})

# 1) Verificaci√≥n que la serie ts_y (mensual, m=12) exista; si no, reconstruirla desde `df`
if (!exists("ts_y")) {
  if (exists("df") && all(c("fecha","valor") %in% names(df))) {
    start_year <- lubridate::year(min(df$fecha, na.rm = TRUE))
    start_mon  <- lubridate::month(min(df$fecha, na.rm = TRUE))
    ts_y <- ts(df$valor, start = c(start_year, start_mon), frequency = 12)
  } else {
    stop("No encuentro 'ts_y' ni 'df'. Ejecutamos previamente la preparaci√≥n de datos de la Unidad 2/3.")
  }
}

# Mini resumen de control
hw_info <- data.frame(
  "Frecuencia" = frequency(ts_y),
  "Inicio"     = paste0(start(time(ts_y))[1], "-", round(start(time(ts_y))[2])),
  "Fin"        = paste0(end(time(ts_y))[1],   "-", round(end(time(ts_y))[2])),
  "Observaciones" = length(ts_y)
)
kable(hw_info, caption = "Control de la serie usada en Holt‚ÄìWinters")
```

## Ajuste de modelos Holt‚ÄìWinters

En esta etapa se aplican las dos variantes del modelo **Holt‚ÄìWinters** (aditiva y multiplicativa) para la serie mensual.  
El m√©todo estima autom√°ticamente los par√°metros Œ±, Œ≤ y Œ≥ minimizando el error cuadr√°tico medio (MSE).  

```{r, message=FALSE, warning=FALSE}
# 1. Divisi√≥n train/test (√∫ltimos 12 meses como test)
n <- length(ts_y)
train <- window(ts_y, end = c(2017, 12))
test  <- window(ts_y, start = c(2018, 1))

# 2. Ajuste modelos aditivo y multiplicativo
fit_add <- HoltWinters(train, seasonal = "additive")
fit_mul <- HoltWinters(train, seasonal = "multiplicative")

# 3. Pron√≥stico a 12 meses
fc_add <- forecast(fit_add, h = 12)
fc_mul <- forecast(fit_mul, h = 12)

# 4. Evaluar desempe√±o con test
acc_add <- accuracy(fc_add, test)
acc_mul <- accuracy(fc_mul, test)

# Construir tabla y redondear SOLO columnas num√©ricas
tab_acc <- tibble::tibble(
  Modelo = c("Aditivo", "Multiplicativo"),
  MAPE   = c(as.numeric(acc_add["Test set","MAPE"]),
             as.numeric(acc_mul["Test set","MAPE"])),
  RMSE   = c(as.numeric(acc_add["Test set","RMSE"]),
             as.numeric(acc_mul["Test set","RMSE"])),
  MAE    = c(as.numeric(acc_add["Test set","MAE"]),
             as.numeric(acc_mul["Test set","MAE"]))
) |>
  dplyr::mutate(dplyr::across(c(MAPE, RMSE, MAE), ~ round(.x, 2)))

knitr::kable(tab_acc, caption = "Tabla 7. Comparaci√≥n de desempe√±o entre modelos Holt‚ÄìWinters")
```

El modelo aditivo obtiene los errores m√°s bajos en todas las m√©tricas:

- MAPE 0.58 % indica una alta precisi√≥n promedio.

- RMSE 375.9 y MAE 290.5 confirman menor dispersi√≥n respecto a los valores reales.

Por tanto, el modelo Holt‚ÄìWinters aditivo se selecciona como el mejor ajuste.


## Gr√°ficas de pron√≥stico y bandas 


```{r, message=FALSE, warning=FALSE}
# Pron√≥stico final con el modelo aditivo
fc_best <- forecast(fit_add, h = 12)

# Gr√°fica del pron√≥stico
autoplot(fc_best) +
  ggplot2::labs(
    title = "Pron√≥stico Holt‚ÄìWinters (Aditivo) ‚Äî 12 meses",
    x = "Tiempo", y = "Turnover (millones de AUD)"
  ) +
  ggplot2::theme_bw()
```

Con el modelo Holt‚ÄìWinters aditivo en el cual se observa se observa una tendencia creciente sostenida, consistente con el crecimiento hist√≥rico del comercio minorista australiano. Un patr√≥n de estacionalidad estable, con picos al cierre de cada a√±o (noviembre-diciembre) y ca√≠das posteriores (enero-febrero).

El pron√≥stico para los 12 meses posteriores mantiene esa estructura: tendencia al alza y fluctuaciones c√≠clicas similares.

Estas caracter√≠sticas confirman que la serie presenta tanto tendencia como estacionalidad aditiva (de magnitud constante en el tiempo).

## Diagn√≥sticos de residuales

```{r, message=FALSE, warning=FALSE}
# Diagn√≥stico de residuales del modelo aditivo
checkresiduals(fit_add)  # ACF de residuales + prueba de Ljung-Box
```

Los residuales presentan media cercana a cero y distribuci√≥n aproximadamente normal.
No obstante, la prueba de Ljung‚ÄìBox (p < 0.05) indica presencia de autocorrelaci√≥n remanente, lo que sugiere posibles mejoras mediante modelos ARIMA estacionales.

## Conclusiones

En esta etapa se implement√≥ la metodolog√≠a **Holt‚ÄìWinters** para el an√°lisis y pron√≥stico de la serie temporal mensual **Australia Monthly Retail Turnover (1982‚Äì2018)**. Este m√©todo permite capturar **tendencia**, **nivel** y **estacionalidad**, utilizando un sistema de ecuaciones recursivas que ajusta los componentes de la serie mediante tres par√°metros de suavizamiento:  

- Œ± (*nivel*),  
- Œ≤ (*tendencia*),  
- Œ≥ (*estacionalidad*).  

El objetivo fue determinar el modelo que mejor describe la estructura temporal y que ofrezca el menor error de pron√≥stico.

---

**Preparaci√≥n y divisi√≥n del conjunto de datos**

Se utiliz√≥ la serie consolidada del total mensual de ventas minoristas (frecuencia = 12).  
Se reservaron los **√∫ltimos 12 meses** (2018) como conjunto de prueba para validar los resultados del modelo.

```{r, message=FALSE, warning=FALSE}
n <- length(ts_y)
train <- window(ts_y, end = c(2017, 12))
test  <- window(ts_y, start = c(2018, 1))
```

**Ajuste de los modelos Holt‚ÄìWinters**

Se estimaron dos versiones del modelo:

- Aditivo: para estacionalidad de magnitud constante.

- Multiplicativo: para estacionalidad proporcional al nivel.

**Pron√≥stico a 12 meses**

Se observa un patr√≥n de crecimiento sostenido acompa√±ado de estacionalidad estable.
El modelo proyecta incrementos hacia los meses finales del a√±o (noviembre‚Äìdiciembre), coherentes con los ciclos de consumo estacional australianos.

```{r, message=FALSE, warning=FALSE}
fc_add <- forecast(fit_add, h = 12)
autoplot(fc_add) +
ggplot2::labs(
title = "Figura 7. Pron√≥stico Holt‚ÄìWinters (Aditivo) ‚Äî 12 meses",
x = "Tiempo", y = "Turnover (millones de AUD)"
) +
ggplot2::theme_bw()
```

**Comparaci√≥n de desempe√±o** 

Se evalu√≥ el error de pron√≥stico con las m√©tricas MAPE, RMSE y MAE, comparando las versiones aditiva y multiplicativa.

El modelo aditivo presenta los menores valores en todas las m√©tricas, por lo cual se selecciona como el modelo final.

**Conclusiones finales del modelo** 

- El modelo Holt‚ÄìWinters aditivo describe adecuadamente el comportamiento de la serie, capturando tanto la tendencia creciente como la estacionalidad anual.

- Las m√©tricas de error (MAPE 0.58 %, RMSE 375.9, MAE 290.5) evidencian una alta precisi√≥n del pron√≥stico.

- Los residuales muestran un comportamiento estable, aunque con cierta autocorrelaci√≥n, lo que sugiere complementar el an√°lisis con modelos SARIMA en etapas posteriores.

- El m√©todo demuestra la utilidad del suavizamiento exponencial triple para pron√≥sticos econ√≥micos, consolidando el uso de herramientas TIC (R + Bookdown) para la elaboraci√≥n reproducible del informe.


# Unidad 5: Modelos estacionarios en series de tiempo


```{r u2-arima, message=FALSE, warning=FALSE}
# Paquetes
library(ggplot2)
library(forecast)
library(tseries)
library(zoo)
theme_set(theme_minimal(base_size = 12))

# 1) Tendencia lineal (uso expl√≠cito de la variable tiempo) 
modelo_lineal <- lm(ts_y ~ time(ts_y))
summary(modelo_lineal)

autoplot(ts_y) +
  geom_abline(
    intercept = coef(modelo_lineal)[1],
    slope     = coef(modelo_lineal)[2],
    color     = "red"
  ) +
  labs(title = "Ajuste de tendencia lineal en la serie",
       x = "Time", y = "Nivel")

# 2) Estacionariedad: ADF y diferenciaciones (d y D) 
# ADF sobre la serie original (H0: ra√≠z unitaria -> no estacionaria)
adf_orig <- adf.test(ts_y)
adf_orig$p.value

# Diferenciaci√≥n no estacional (d=1) y estacional (D=1, s=12)
ts_d1   <- diff(ts_y, differences = 1)
ts_D1   <- diff(ts_y, lag = 12)
ts_d1D1 <- diff(ts_d1, lag = 12)

# ADF tras d=1
adf_d1 <- adf.test(na.omit(ts_d1))
adf_d1$p.value

# ADF tras d=1 y D=1
adf_d1D1 <- adf.test(na.omit(ts_d1D1))
adf_d1D1$p.value

# Visual: serie diferenciada final
autoplot(ts_d1D1) +
  labs(title = "Serie diferenciada (d=1, D=1, s=12)",
       x = "Time", y = "ŒîŒî serie")

# 3) Identificaci√≥n r√°pida: ACF/PACF de la serie estacionaria 
gridExtra::grid.arrange(
  ggAcf(na.omit(ts_d1D1)) + labs(title = "ACF de la serie estacionaria"),
  ggPacf(na.omit(ts_d1D1)) + labs(title = "PACF de la serie estacionaria"),
  nrow = 1
)

# 4) Estimaci√≥n ARIMA (permitimos b√∫squeda exhaustiva)
# Si ya sabes que debe haber d=1 y D=1 con s=12, lo fijas:
fit <- auto.arima(
  ts_y,
  d = 1, D = 1, seasonal = TRUE,
  stepwise = FALSE, approximation = FALSE, biasadj = TRUE
)
fit
summary(fit)

# 5) Diagn√≥stico de residuales
checkresiduals(fit)   # incluye Ljung-Box; busca p-value alto

# Prueba Ljung-Box expl√≠cita en 24 rezagos (aprox. 2 a√±os)
Box.test(residuals(fit), lag = 24, type = "Ljung-Box", fitdf = length(coef(fit)))

# 6) Pron√≥stico a 12 periodos
fc <- forecast(fit, h = 12)
autoplot(fc) +
  labs(title = "Pron√≥stico ARIMA a 12 periodos",
       x = "Time", y = "Nivel")

# Tabla breve de pron√≥stico (punto e intervalos)
data.frame(
  Fecha      = as.yearmon(time(fc$mean)),
  Punto      = as.numeric(fc$mean),
  LI_80      = as.numeric(fc$lower[,"80%"]),
  LS_80      = as.numeric(fc$upper[,"80%"]),
  LI_95      = as.numeric(fc$lower[,"95%"]),
  LS_95      = as.numeric(fc$upper[,"95%"])
)
```

M√©tricas (RMSE/MAE/ MAPE) con un holdout de 12 meses:

```{r u2-holdout, message=FALSE, warning=FALSE}
h <- 12
n <- length(ts_y)
ts_train <- window(ts_y, end = time(ts_y)[n - h])
ts_test  <- window(ts_y, start = time(ts_y)[n - h + 1])

fit_tr <- auto.arima(ts_train, d=1, D=1, seasonal=TRUE,
                     stepwise=FALSE, approximation=FALSE, biasadj=TRUE)
fc_tr  <- forecast(fit_tr, h = h)

# M√©tricas sobre el holdout
accuracy(fc_tr, ts_test)
```


## Evaluaci√≥n de estacionariedad

Al analizar la serie original se identific√≥ una clara tendencia creciente y presencia de estacionalidad mensual. Para eliminar dichos componentes y lograr una serie estacionaria, se aplic√≥ una diferenciaci√≥n de primer orden.
En la Figura siguiente se observa c√≥mo, despu√©s del proceso de diferenciaci√≥n, la media de la serie se estabiliza alrededor de cero, lo que indica que la tendencia fue eliminada.

La dispersi√≥n, sin embargo, sigue mostrando cierta variabilidad, coherente con la magnitud de las fluctuaciones estacionales a lo largo del tiempo.

## Identificaci√≥n y estimaci√≥n del modelo ARIMA

A trav√©s de la funci√≥n auto.arima() se seleccion√≥ el modelo ARIMA(3,1,2)(0,1,1)[12], el cual incorpora una diferenciaci√≥n no estacional y otra estacional con periodicidad de 12 meses.
Este modelo combina tres t√©rminos autorregresivos (AR), una diferenciaci√≥n y dos componentes de media m√≥vil (MA), junto con un componente estacional MA(1).

## Diagn√≥stico de residuales

En la Figura de diagn√≥stico se observa que los residuales se distribuyen de manera aleatoria alrededor de cero, sin patrones de autocorrelaci√≥n significativos en la funci√≥n ACF, lo cual valida la adecuaci√≥n del modelo ajustado.
El histograma de residuales muestra una aproximaci√≥n a la normalidad, confirmando que los errores se comportan como ruido blanco, es decir, sin informaci√≥n adicional que el modelo no haya capturado.

## Pron√≥stico del modelo

Finalmente, se gener√≥ un pron√≥stico a 12 periodos (equivalentes a un a√±o).
La Figura muestra la prolongaci√≥n de la serie con una tendencia de crecimiento moderado y componente estacional estable, coherente con el comportamiento hist√≥rico del √≠ndice de ventas minoristas australianas.
Las bandas azules representan los intervalos de confianza, dentro de los cuales se espera que se mantenga la variabilidad futura del fen√≥meno.

## Conclusi√≥n modelos estacionarios

El modelo ARIMA(3,1,2)(0,1,1)[12] demostr√≥ un buen ajuste y capacidad predictiva para la serie analizada.
Su desempe√±o confirma que, al eliminar la tendencia y la estacionalidad mediante diferenciaciones, el proceso subyacente se vuelve estacionario, permitiendo realizar pron√≥sticos confiables de corto plazo.
En t√©rminos pr√°cticos, este resultado respalda la utilidad del enfoque Box-Jenkins en el an√°lisis de indicadores econ√≥micos peri√≥dicos como el Retail Turnover.

# Unidad 6: Modelo Prophet y serie de tiempo como regresi√≥n en el tiempo

En esta unidad se incorpora el algoritmo **Facebook Prophet** como alternativa de modelaci√≥n y pron√≥stico para la serie mensual *Australia Monthly Retail Turnover*. El objetivo es:

1. Ajustar un modelo Prophet sobre la misma serie utilizada en las unidades anteriores.  
2. Analizar sus componentes (tendencia y estacionalidad) y el pron√≥stico a 12 meses.  
3. Justificar la interpretaci√≥n de la serie como una **regresi√≥n en el tiempo**, conectando Prophet con el modelo de tendencia lineal y con los enfoques estacionarios (ARIMA/SARIMA).

## Fundamentos del modelo Prophet

Prophet es un modelo de pron√≥stico desarrollado por Facebook que se formula como una **regresi√≥n aditiva en el tiempo**:

\[
y_t = g(t) + s(t) + h(t) + \varepsilon_t,
\]

donde:

- \( g(t) \): componente de **tendencia** (lineal o log√≠stica) con posibles puntos de cambio,
- \( s(t) \): componente **estacional**, modelado mediante funciones de Fourier,
- \( h(t) \): efectos de **festivos o eventos especiales** (si se incluyen),
- \( \varepsilon_t \): t√©rmino de error (ruido).

En este enfoque, el **tiempo \(t\) y funciones derivadas del tiempo** (por ejemplo, senos y cosenos para la estacionalidad) act√∫an como **regresores** dentro de un modelo de regresi√≥n generalizado. De esta manera, Prophet se entiende como una regresi√≥n donde la variable respuesta es el *retail turnover* mensual y las variables explicativas son funciones del tiempo (tendencia, estacionalidad y eventos).


## Preparaci√≥n de datos y ajuste del modelo Prophet


Para aplicar el modelo Facebook Prophet dentro del flujo de trabajo del curso, es necesario convertir la serie mensual en un formato adecuado para los paquetes modernos de an√°lisis temporal. En particular, Prophet ‚Äîa trav√©s del paquete fable.prophet‚Äî requiere que los datos est√©n organizados como un tsibble, una estructura ordenada que define expl√≠citamente el √≠ndice temporal y garantiza que cada observaci√≥n corresponda a un √∫nico punto en el tiempo.

Esta conversi√≥n permite que el modelo reconozca autom√°ticamente la frecuencia mensual de la serie, identifique discontinuidades, maneje estacionalidades y procese de forma eficiente las funciones de tendencia y componente estacional. Una vez estructurada la informaci√≥n en formato tsibble, se ajusta el modelo Prophet, el cual interpreta la serie como una regresi√≥n aditiva en el tiempo compuesta por tendencia, estacionalidad y ruido, coherente con los supuestos explorados en las unidades anteriores.

En esta secci√≥n se presenta la preparaci√≥n de la serie consolidada y el ajuste del modelo Prophet para generar un pron√≥stico coherente con el comportamiento hist√≥rico del Retail Turnover australiano.


```{r echo=FALSE, message=FALSE, warning=FALSE}

suppressPackageStartupMessages({
  library(dplyr)
  library(ggplot2)
  library(tsibble)
  library(fable)
  library(fable.prophet)  
  library(fabletools)
  library(knitr)
})

# Verificar que existe la serie consolidada df y la columna fecha
stopifnot(exists("df"), all(c("fecha","valor") %in% names(df)))

# Convertir a tsibble para usar fable/fable.prophet
serie_ts <- df %>%
  as_tsibble(index = fecha)


```

La Tabla 12 presenta las primeras 12 observaciones de la serie en formato tsibble. En ella se reconoce la columna fecha como √≠ndice temporal mensual, mientras que valor corresponde al nivel observado del retail turnover en millones de d√≥lares australianos. Las columnas Nivel, SMA (12m) y EMA (6m) son variables derivadas de la Unidad 2 (serie original y promedios m√≥viles simple y exponencial); por eso, en los primeros registros los promedios m√≥viles aparecen como NA, ya que a√∫n no se dispone de suficientes meses previos para calcular las ventanas de 6 o 12 periodos.

Esta salida confirma que la serie est√° correctamente ordenada en el tiempo y que cada fecha tiene una √∫nica observaci√≥n, condici√≥n necesaria para trabajar con tsibble y para ajustar el modelo Prophet en los pasos siguientes.

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Pasar df a tsibble para trabajar con fable / Prophet
serie_ts <- df %>%
  as_tsibble(index = fecha)

# Vista r√°pida de las primeras filas (sin escribir "Tabla X" en el caption)
serie_ts %>%
  head(12) %>%
  knitr::kable(
    caption = "Primeras 12 observaciones de la serie en formato tsibble.",
    align = "c"
  )

```


## Ajuste del modelo Prophet y an√°lisis de componentes

En esta secci√≥n se ajusta el modelo Prophet sobre la serie mensual de ventas minoristas australianas utilizando el paquete fable.prophet.

El objetivo es ajustar y analizar el modelo Prophet para la serie mensual Australia Monthly Retail Turnover, interpretando sus componentes (tendencia y estacionalidad) y justificando por qu√© Prophet puede entenderse como una regresi√≥n en el tiempo.



```{r prophet-ajuste, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Pron√≥stico a 12 meses con el modelo Prophet"}

suppressPackageStartupMessages({
  library(dplyr)
  library(tsibble)
  library(fable)
  library(fable.prophet)
  library(fabletools)
  library(ggplot2)
})

# 0) Reconstruir la serie en formato tsibble (por si la sesi√≥n se reinici√≥)
serie_ts <- df %>%
  dplyr::select(fecha, valor) %>%
  as_tsibble(index = fecha)

# 1) Ajustar el modelo Prophet con estacionalidad anual
modelo_prophet <- serie_ts %>%
  model(
    prophet = prophet(valor ~ season("year"))
  )

# 2) Pron√≥stico a 12 meses
fc_prophet <- modelo_prophet %>%
  forecast(h = "12 months")

# 3) Gr√°fico del pron√≥stico (queda numerado como Figura por el fig.cap)
autoplot(fc_prophet, serie_ts) +
  labs(
    title = "Pron√≥stico a 12 meses con el modelo Prophet",
    x = "Fecha",
    y = "Turnover (millones de AUD)"
  ) +
  theme_bw()



```
La figura muestra el pron√≥stico a 12 meses generado con el modelo Prophet a partir de la serie mensual de Retail Turnover en Australia. En la parte hist√≥rica (l√≠nea negra) se observa nuevamente una tendencia claramente creciente en el volumen de ventas minoristas, acompa√±ada de picos estacionales muy marcados hacia el final de cada a√±o y descensos en los primeros meses, patr√≥n que ya se hab√≠a identificado con Holt‚ÄìWinters y SARIMA.

En la zona sombreada azul se visualiza el pron√≥stico para el a√±o siguiente, donde el modelo proyecta que el retail turnover continuar√° creciendo, manteniendo la misma estructura de comportamiento: aumentos graduales a lo largo del a√±o y m√°ximos en los meses de cierre (noviembre‚Äìdiciembre), con posteriores ca√≠das estacionales. Las bandas de confianza al 80 % y 95 % se abren ligeramente conforme avanza el horizonte de tiempo, reflejando una incertidumbre moderada pero controlada: el intervalo es relativamente estrecho frente al nivel de la serie, lo que indica que Prophet logra capturar de forma estable la combinaci√≥n de tendencia y estacionalidad. En conjunto, el resultado confirma que el modelo Prophet reproduce adecuadamente el patr√≥n hist√≥rico y ofrece pron√≥sticos coherentes con la din√°mica observada del comercio minorista australiano.

 **Componentes del modelo Prophet: tendencia y estacionalidad**
 
La figura muestra la descomposici√≥n del modelo Prophet aplicada a la serie mensual Retail Turnover de Australia. Prophet expresa la serie como la suma (y en algunos casos multiplicaci√≥n) de tres elementos principales: tendencia, estacionalidad y residuo. La visualizaci√≥n de estos componentes permite entender c√≥mo el modelo explica la din√°mica temporal del comportamiento de las ventas minoristas.

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Componentes del modelo Prophet sobre los datos hist√≥ricos

# Asegurar paquetes
suppressPackageStartupMessages({
  library(fable)
  library(fable.prophet)
  library(fabletools)
  library(ggplot2)
})

# 1) Obtener componentes del modelo (tendencia y estacionalidad)
comp_prophet <- components(modelo_prophet)

# 2) Gr√°fico de los componentes
autoplot(comp_prophet) +
  labs(
    title = "Componentes del modelo Prophet: tendencia y estacionalidad",
    x = "Fecha",
    y = NULL
  ) +
  theme_bw()


```

**1. Componente original (valor)**

Corresponde a la serie observada hist√≥ricamente. Se identifica nuevamente una combinaci√≥n de:

- Una tendencia creciente sostenida en el tiempo.

- Picos estacionales marcados al cierre de cada a√±o.

- Descensos recurrentes al inicio de cada periodo anual.

**2. Tendencia (trend)**

Refleja el comportamiento de largo plazo de la serie.

- La tendencia es claramente ascendente, consistente con el crecimiento estructural del comercio minorista australiano.

- La pendiente se incrementa especialmente a partir de los a√±os 2000, sugiriendo un ritmo de expansi√≥n mayor.

Este t√©rmino corresponde a $ùëî(ùë°)$, el componente determin√≠stico que modela la evoluci√≥n general del nivel de ventas en funci√≥n del tiempo.

**3. T√©rminos multiplicativos (multiplicative_terms)**

Este componente aparece pr√°cticamente plano.

- Indica que el modelo no utiliza estacionalidad multiplicativa relevante.

- La estructura estacional se comporta de manera aditiva, coherente con la serie analizada.

**4. T√©rminos aditivos (additive_terms)**

Representan la estacionalidad anual modelada mediante funciones de Fourier.

- Exhiben un ciclo regular con m√°ximos en noviembre‚Äìdiciembre y m√≠nimos en enero‚Äìfebrero.

- La amplitud del ciclo es estable, lo que indica un patr√≥n estacional consistente a lo largo del tiempo.

- Este componente corresponde al t√©rmino $ùë†(ùë°)$, que captura los comportamientos peri√≥dicos de la serie a trav√©s de funciones trigonom√©tricas.

**5. Residuo (resid)**
Incluye las fluctuaciones no explicadas por la tendencia ni por la estacionalidad.

- No se observan patrones sistem√°ticos, lo que indica que el modelo captura adecuadamente la estructura determinista de la serie.

- Se observan picos puntuales, probablemente asociados a eventos at√≠picos del sector.

## Comparaci√≥n de desempe√±o entre Holt‚ÄìWinters, ARIMA y Prophet

El objetivo de esta secci√≥n es comparar cuantitativamente el rendimiento de los tres enfoques de pron√≥stico aplicados a la serie Australia Monthly Retail Turnover: el modelo Holt‚ÄìWinters aditivo, el modelo ARIMA estacional y el modelo Prophet.

Para ello, se utiliza una partici√≥n temporal com√∫n: los √∫ltimos 12 meses de la serie se reservan como conjunto de prueba (test), mientras que el resto se emplea para entrenar cada modelo.
Sobre ese horizonte de 12 meses se calculan las m√©tricas RMSE, MAE y MAPE, lo cual permite evaluar qu√© m√©todo ofrece mejor precisi√≥n en t√©rminos de error absoluto, cuadr√°tico y relativo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Horizonte de evaluaci√≥n

h <- 12

# 1) Partici√≥n com√∫n train/test

n <- length(ts_y)
ts_train <- window(ts_y, end   = time(ts_y)[n - h])
ts_test  <- window(ts_y, start = time(ts_y)[n - h + 1])

# 2) Holt‚ÄìWinters aditivo

fit_hw <- HoltWinters(ts_train, seasonal = "additive")
fc_hw  <- forecast(fit_hw, h = h)

# 3) ARIMA estacional (misma l√≥gica usada antes)

fit_arima <- auto.arima(
ts_train,
d = 1, D = 1, seasonal = TRUE,
stepwise = FALSE, approximation = FALSE, biasadj = TRUE
)
fc_arima <- forecast(fit_arima, h = h)

# 4) Prophet entrenado sobre el mismo tramo de entrenamiento

library(tsibble)
library(fable)
library(fable.prophet)
library(dplyr)

# N√∫mero de observaciones de entrenamiento (las mismas que tiene ts_train)
len_train <- length(ts_train)

# Tomar las primeras len_train filas de df y convertirlas a tsibble
df_train <- df[1:len_train, ] %>%
  as_tsibble(index = fecha)


fit_prophet <- df_train |>
model(prophet = prophet(valor ~ season("year")))

fc_prophet <- forecast(fit_prophet, h = h)

pred_prophet <- fc_prophet |>
as_tibble() |>
dplyr::pull(.mean) |>
as.numeric()

# 5) M√©tricas de error

m_hw    <- accuracy(fc_hw,   ts_test)
m_arima <- accuracy(fc_arima, ts_test)

calc_metrics <- function(pred, real){
err <- real - pred
data.frame(
RMSE = sqrt(mean(err^2, na.rm = TRUE)),
MAE  = mean(abs(err), na.rm = TRUE),
MAPE = mean(abs(err/real), na.rm = TRUE) * 100
)
}
m_prophet <- calc_metrics(pred_prophet, as.numeric(ts_test))

tab_modelos <- data.frame(
Modelo = c("Holt‚ÄìWinters aditivo",
"ARIMA estacional",
"Prophet"),
RMSE = c(m_hw["Test set","RMSE"],
m_arima["Test set","RMSE"],
m_prophet$RMSE),
MAE  = c(m_hw["Test set","MAE"],
m_arima["Test set","MAE"],
m_prophet$MAE),
MAPE = c(m_hw["Test set","MAPE"],
m_arima["Test set","MAPE"],
m_prophet$MAPE)
) |>
dplyr::mutate(dplyr::across(c(RMSE, MAE, MAPE), ~ round(.x, 2)))

knitr::kable(
tab_modelos,
caption = "Comparaci√≥n de RMSE, MAE y MAPE para Holt‚ÄìWinters, ARIMA y Prophet (horizonte de 12 meses).",
align = "c"
)

```
La Tabla anterior presenta los valores de RMSE, MAE y MAPE obtenidos para los tres modelos evaluados (Holt‚ÄìWinters aditivo, ARIMA estacional y Prophet) utilizando un horizonte de predicci√≥n de 12 meses. Estas m√©tricas permiten comparar su capacidad predictiva bajo un mismo conjunto de prueba.

En primer lugar, se observa que Holt‚ÄìWinters aditivo presenta el mejor desempe√±o general, con el menor RMSE (375.90), menor MAE (290.53) y un MAPE muy bajo (0.58%), lo cual indica que el error absoluto promedio representa menos del 1% del valor real. Este resultado confirma que, para series altamente estacionales y con un patr√≥n relativamente suave, los modelos exponenciales suavizados pueden capturar adecuadamente la din√°mica temporal.

El modelo ARIMA estacional tambi√©n obtiene un buen desempe√±o, aunque ligeramente inferior al de Holt‚ÄìWinters. Sus valores de RMSE (409.19) y MAE (346.70) son mayores, y el MAPE (0.70%) evidencia un aumento leve en la proporci√≥n del error. Sin embargo, contin√∫a siendo un modelo s√≥lido para este tipo de series.

Finalmente, el modelo Prophet es el que muestra el desempe√±o m√°s d√©bil, con errores sustancialmente m√°s altos (RMSE de 10083.90 y MAE de 9764.46) y un MAPE de 19.55%, valor muy superior al de los otros dos m√©todos. Esto sugiere que Prophet no logr√≥ capturar adecuadamente la estructura temporal en este conjunto particular, posiblemente debido a la intensidad de la estacionalidad mensual y al comportamiento local de la serie, que favorece m√°s a modelos cl√°sicos como Holt‚ÄìWinters o ARIMA.

En s√≠ntesis, el mejor modelo para este caso espec√≠fico es Holt‚ÄìWinters aditivo, seguido por ARIMA estacional, mientras que Prophet no resulta competitivo bajo estas condiciones.

## Comparaci√≥n de modelos y conclusiones

En las secciones anteriores se ajustaron y analizaron tres enfoques de modelamiento para la serie mensual Retail Turnover de Australia: modelos suavizados (Holt‚ÄìWinters), modelos ARIMA estacionales y el algoritmo Prophet. Cada uno aporta una perspectiva diferente sobre la estructura temporal de la serie y permite analizar c√≥mo se combinan tendencia, estacionalidad y variabilidad residual.

Los modelos Holt‚ÄìWinters y ARIMA representan enfoques cl√°sicos. Holt‚ÄìWinters captur√≥ adecuadamente la tendencia creciente y la estacionalidad mensual mediante suavizamiento exponencial, mostrando pron√≥sticos estables y con bajo error. ARIMA, por su parte, incorpora una estructura estoc√°stica m√°s flexible, modelando la autocorrelaci√≥n y la estacionalidad mediante t√©rminos diferenciados. Ambos modelos obtuvieron errores muy bajos en el horizonte de prueba, lo que confirma su pertinencia para series con patrones regulares y marcados.

El modelo Prophet ofrece una perspectiva distinta al interpretar la serie como una regresi√≥n aditiva en el tiempo, donde la tendencia y la estacionalidad se modelan mediante funciones determin√≠sticas del tiempo (incluidas bases de Fourier). Esta formulaci√≥n resulta √∫til para obtener una descomposici√≥n clara de la tendencia y los ciclos anuales. Sin embargo, aunque Prophet es conceptualmente interpretativo, su desempe√±o predictivo fue considerablemente menor en este caso, como lo evidencian los valores de RMSE, MAE y MAPE, mucho m√°s altos en comparaci√≥n con Holt‚ÄìWinters y ARIMA.

Esto sugiere que, para esta serie en particular, caracterizada por una estacionalidad mensual muy pronunciada y patrones altamente regulares, los m√©todos cl√°sicos (Holt‚ÄìWinters y ARIMA) capturan mejor la din√°mica temporal. No obstante, Prophet sigue siendo valioso porque complementa la visi√≥n estad√≠stica tradicional con un enfoque de regresi√≥n funcional, permitiendo interpretar la serie en t√©rminos de componentes determin√≠sticos y tendencia suavizada.

En s√≠ntesis, aunque todos los modelos permiten describir la estructura de la serie, el mejor desempe√±o predictivo lo obtuvo Holt‚ÄìWinters, seguido por ARIMA. Prophet, si bien proporciona una representaci√≥n interpretativa clara de la tendencia y la estacionalidad, no fue el modelo m√°s adecuado para este conjunto de datos. Su inclusi√≥n, sin embargo, enriquece el an√°lisis al ofrecer una visi√≥n alternativa basada en regresi√≥n sobre el tiempo, lo que aporta coherencia conceptual al desarrollo del documento en esta fase del proyecto.
